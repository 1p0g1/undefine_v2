"use strict";exports.id=58,exports.ids=[58],exports.modules={6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7274:(e,t,r)=>{r.d(t,{o:()=>s});function s(e){return async(t,r)=>{if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===t.method){r.status(204).end();return}return e(t,r)}}},9085:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{O:()=>i});var o=r(9926),a=e([o]);let n=(o=(a.then?(await a)():a)[0]).z.object({SUPABASE_URL:o.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:o.z.string(),SUPABASE_ANON_KEY:o.z.string(),DB_PROVIDER:o.z.literal("supabase"),NODE_ENV:o.z.enum(["development","production"]).default("production"),PORT:o.z.string().transform(Number).default("3001"),FRONTEND_URL:o.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:"https://eaclljwvsicezmkjnlbm.supabase.co",SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjk3NzIsImV4cCI6MjA1OTYwNTc3Mn0.56sdQFmC4sNAbyenWoDeiA",DB_PROVIDER:"supabase",NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!n.success)throw console.error("❌ Invalid environment variables:\n",Object.entries(n.error.flatten().fieldErrors).map(([e,t])=>`${e}: ${t?.join(", ")}`).join("\n")),Error("Invalid environment variables");let i=n.data;s()}catch(e){s(e)}})},4229:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{Gu:()=>p,Ry:()=>g,gt:()=>w,gz:()=>u,nu:()=>d,s6:()=>h});var o=r(2885),a=r(9085),n=r(301),i=e([a]);a=(i.then?(await i)():i)[0];let y=(0,o.createClient)(a.O.SUPABASE_URL,a.O.SUPABASE_SERVICE_ROLE_KEY);async function l(e){try{let t=new Date(e),r=c(t),s=m(t);console.log("[getThemeForDate] Looking for theme between:",{date:e,weekStart:r.toISOString().split("T")[0],weekEnd:s.toISOString().split("T")[0]});let{data:o,error:a}=await y.from("words").select("theme").gte("date",r.toISOString().split("T")[0]).lte("date",s.toISOString().split("T")[0]).not("theme","is",null).order("date",{ascending:!0}).limit(1);if(a)return console.error("[getThemeForDate] Database error:",a),null;let n=o?.[0]?.theme||null;return console.log("[getThemeForDate] Found theme:",n),n}catch(e){return console.error("[getThemeForDate] Error:",e),null}}async function d(e,t){if(!e||!t)return{isCorrect:!1,method:"error",confidence:0};let{matchThemeWithFuzzy:s}=await r.e(367).then(r.bind(r,9367));try{let r=await s(e,t);return{isCorrect:r.isMatch,method:r.method,confidence:r.confidence,similarity:r.similarity}}catch(s){console.error("[isThemeGuessCorrect] Error:",s);let r=function(e,t){if(!e||!t)return!1;let r=(0,n.bG)(e),s=(0,n.bG)(t);if(r===s)return!0;let o={emotions:["feelings","moods","sentiments","emotions"],space:["astronomy","cosmos","universe","celestial","space"],animals:["creatures","wildlife","beasts","fauna","animals"],food:["cuisine","meals","eating","cooking","food"],colors:["colours","hues","shades","tints","colors"],weather:["climate","meteorology","atmospheric","weather"],music:["musical","songs","melodies","instruments","music"],sports:["athletics","games","competition","physical","sports"],language:["words","vocabulary","linguistics","speech","terminology","lexicon","language"]}[s]||[s];return!!(o.some(e=>(0,n.bG)(e)===r)||o.some(e=>r.includes((0,n.bG)(e))||(0,n.bG)(e).includes(r)))}(e,t);return{isCorrect:r,method:"error",confidence:r?90:0}}}function c(e){let t=new Date(e),r=t.getDay(),s=t.getDate()-r+(0===r?-6:1);return t.setDate(s),t.setHours(0,0,0,0),t}function m(e){let t=c(e);return t.setDate(t.getDate()+6),t.setHours(23,59,59,999),t}async function u(){let e=new Date().toISOString().split("T")[0];return l(e)}async function h(e,t,r){try{let s=new Date().toISOString().split("T")[0],{data:o}=await y.from("theme_attempts").select("id").eq("player_id",e).eq("theme",t).eq("attempt_date",s).single();if(o)return{success:!1,isCorrect:!1,alreadyGuessedToday:!0,wordsCompleted:0,totalGuesses:0};let a=await p(e,t),{data:n}=await y.from("game_sessions").select("guesses").eq("player_id",e).eq("is_complete",!0),i=n?.reduce((e,t)=>e+(t.guesses?.length||0),0)||0,l=await d(r,t),c=l.isCorrect;console.log("[submitThemeAttempt] Theme guess validation:",{guess:r.trim(),theme:t,isCorrect:c,method:l.method,confidence:l.confidence,similarity:l.similarity});let{error:m}=await y.from("theme_attempts").insert({player_id:e,theme:t,guess:r.trim(),is_correct:c,attempt_date:s,words_completed_when_guessed:a.completedWords,total_word_guesses:i});if(m)return console.error("[submitThemeAttempt] Insert error:",m),{success:!1,isCorrect:!1,alreadyGuessedToday:!1,wordsCompleted:a.completedWords,totalGuesses:i};return{success:!0,isCorrect:c,alreadyGuessedToday:!1,wordsCompleted:a.completedWords,totalGuesses:i}}catch(e){return console.error("[submitThemeAttempt] Error:",e),{success:!1,isCorrect:!1,alreadyGuessedToday:!1,wordsCompleted:0,totalGuesses:0}}}async function g(e){try{let{data:t,error:r}=await y.from("theme_attempts").select("theme, is_correct, words_completed_when_guessed").eq("player_id",e);if(r)return console.error("[getPlayerThemeStats] Error:",r),{totalThemeAttempts:0,correctThemeGuesses:0,averageAttemptsPerTheme:0,averageWordsCompletedWhenGuessing:0,themesGuessed:[]};let s=t?.length||0,o=t?.filter(e=>e.is_correct).length||0,a=Array.from(new Set(t?.map(e=>e.theme)||[])),n=a.length>0?s/a.length:0,i=s>0?(t?.reduce((e,t)=>e+(t.words_completed_when_guessed||0),0)||0)/s:0;return{totalThemeAttempts:s,correctThemeGuesses:o,averageAttemptsPerTheme:Math.round(100*n)/100,averageWordsCompletedWhenGuessing:Math.round(100*i)/100,themesGuessed:t?.filter(e=>e.is_correct).map(e=>e.theme)||[]}}catch(e){return console.error("[getPlayerThemeStats] Error:",e),{totalThemeAttempts:0,correctThemeGuesses:0,averageAttemptsPerTheme:0,averageWordsCompletedWhenGuessing:0,themesGuessed:[]}}}async function p(e,t){try{let{monday:r,sunday:s}=f(),{data:o,error:a}=await y.from("words").select("id, word, date").eq("theme",t).gte("date",r.toISOString().split("T")[0]).lte("date",s.toISOString().split("T")[0]).order("date",{ascending:!0});if(a)return console.error("[getThemeProgress] Database error:",a),{totalWords:0,completedWords:0,themeGuess:null,canGuessTheme:!1,hasGuessedToday:!1,isCorrectGuess:!1};let n=o?.map(e=>e.id)||[],{data:i,error:l}=await y.from("game_sessions").select("word_id, is_complete").eq("player_id",e).in("word_id",n);if(l)return console.error("[getThemeProgress] Database error:",l),{totalWords:o?.length||0,completedWords:0,themeGuess:null,canGuessTheme:!1,hasGuessedToday:!1,isCorrectGuess:!1};let d=i?.filter(e=>e.is_complete)||[],c=new Date().toISOString().split("T")[0],{data:m,error:u}=await y.from("theme_attempts").select("guess, is_correct").eq("player_id",e).eq("theme",t).eq("attempt_date",c).single();u&&"PGRST116"!==u.code&&console.error("[getThemeProgress] Theme attempt error:",u);let h=d.length>0;return{totalWords:o?.length||0,completedWords:d.length,themeGuess:m?.guess||null,canGuessTheme:h&&!m,hasGuessedToday:!!m,isCorrectGuess:m?.is_correct||!1}}catch(e){return console.error("[getThemeProgress] Error:",e),{totalWords:0,completedWords:0,themeGuess:null,canGuessTheme:!1,hasGuessedToday:!1,isCorrectGuess:!1}}}function f(e=new Date){let t=c(e),r=m(e);return{monday:t,sunday:r}}async function w(e,t){try{let{monday:r,sunday:s}=f();console.log("[getPlayerWeeklyThemedWords] Getting weekly themed words for player:",{playerId:e,theme:t,weekStart:r.toISOString().split("T")[0],weekEnd:s.toISOString().split("T")[0]});let{data:o,error:a}=await y.from("words").select("id, word, date").eq("theme",t).gte("date",r.toISOString().split("T")[0]).lte("date",s.toISOString().split("T")[0]).order("date",{ascending:!0});if(a)return console.error("[getPlayerWeeklyThemedWords] Error fetching themed words:",a),[];if(!o||0===o.length)return console.log("[getPlayerWeeklyThemedWords] No themed words found for current week"),[];let n=o.map(e=>e.id),{data:i,error:l}=await y.from("game_sessions").select("word_id, created_at").eq("player_id",e).eq("is_complete",!0).in("word_id",n);if(l)return console.error("[getPlayerWeeklyThemedWords] Error fetching completed sessions:",l),[];let d=o.filter(e=>i?.some(t=>t.word_id===e.id)).map(e=>{let t=i?.find(t=>t.word_id===e.id);return{id:e.id,word:e.word,date:e.date,completedOn:t?.created_at||e.date}});return console.log("[getPlayerWeeklyThemedWords] Found completed themed words:",{totalThemedWords:o.length,completedCount:d.length,completedWords:d.map(e=>({word:e.word,date:e.date}))}),d}catch(e){return console.error("[getPlayerWeeklyThemedWords] Error:",e),[]}}s()}catch(e){s(e)}})},301:(e,t,r)=>{r.d(t,{bG:()=>s,oe:()=>o});let s=e=>e?e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[\u200B\u200D\u200C\uFEFF-]/g,""):"",o=(e,t)=>s(e)===s(t)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};