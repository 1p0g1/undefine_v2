"use strict";exports.id=58,exports.ids=[58],exports.modules={6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7274:(e,t,r)=>{r.d(t,{o:()=>o});function o(e){return async(t,r)=>{if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===t.method){r.status(204).end();return}return e(t,r)}}},9085:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{O:()=>l});var s=r(9926),n=e([s]);let a=(s=(n.then?(await n)():n)[0]).z.object({SUPABASE_URL:s.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:s.z.string(),SUPABASE_ANON_KEY:s.z.string(),DB_PROVIDER:s.z.literal("supabase"),NODE_ENV:s.z.enum(["development","production"]).default("production"),PORT:s.z.string().transform(Number).default("3001"),FRONTEND_URL:s.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:process.env.SUPABASE_URL,SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:process.env.SUPABASE_ANON_KEY,DB_PROVIDER:"supabase",NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!a.success)throw console.error("âŒ Invalid environment variables:\n",Object.entries(a.error.flatten().fieldErrors).map(([e,t])=>`${e}: ${t?.join(", ")}`).join("\n")),Error("Invalid environment variables");let l=a.data;o()}catch(e){o(e)}})},4229:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Gu:()=>p,Ry:()=>g,gt:()=>f,gz:()=>u,nu:()=>d,s6:()=>h,sS:()=>w});var s=r(2885),n=r(9085),a=r(301),l=e([n]);n=(l.then?(await l)():l)[0];let y=(0,s.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_SERVICE_ROLE_KEY);async function i(e){try{let t=new Date(e),r=c(t),o=m(t);console.log("[getThemeForDate] Looking for theme between:",{date:e,weekStart:r.toISOString().split("T")[0],weekEnd:o.toISOString().split("T")[0]});let{data:s,error:n}=await y.from("words").select("theme").gte("date",r.toISOString().split("T")[0]).lte("date",o.toISOString().split("T")[0]).not("theme","is",null).order("date",{ascending:!0}).limit(1);if(n)return console.error("[getThemeForDate] Database error:",n),null;let a=s?.[0]?.theme||null;return console.log("[getThemeForDate] Found theme:",a),a}catch(e){return console.error("[getThemeForDate] Error:",e),null}}async function d(e,t){if(!e||!t)return{isCorrect:!1,method:"error",confidence:0};let{matchThemeWithFuzzy:o}=await r.e(367).then(r.bind(r,9367));try{let r=await o(e,t);return{isCorrect:r.isMatch,method:r.method,confidence:r.confidence,similarity:r.similarity}}catch(o){console.error("[isThemeGuessCorrect] Error:",o);let r=function(e,t){if(!e||!t)return!1;let r=(0,a.bG)(e),o=(0,a.bG)(t);return r===o}(e,t);return{isCorrect:r,method:"error",confidence:r?90:0}}}function c(e){let t=new Date(e),r=t.getDay(),o=t.getDate()-r+(0===r?-6:1);return t.setDate(o),t.setHours(0,0,0,0),t}function m(e){let t=c(e);return t.setDate(t.getDate()+6),t.setHours(23,59,59,999),t}async function u(){let e=new Date().toISOString().split("T")[0];return i(e)}async function h(e,t,r){try{let o=new Date().toISOString().split("T")[0],{data:s}=await y.from("theme_attempts").select("id").eq("player_id",e).eq("theme",t).eq("attempt_date",o).single();if(s)return{success:!1,isCorrect:!1,alreadyGuessedToday:!0,wordsCompleted:0,totalGuesses:0};let n=await p(e,t),{data:a}=await y.from("game_sessions").select("guesses").eq("player_id",e).eq("is_complete",!0),l=a?.reduce((e,t)=>e+(t.guesses?.length||0),0)||0,i=await d(r,t),c=i.isCorrect;console.log("[submitThemeAttempt] Theme guess validation:",{guess:r.trim(),theme:t,isCorrect:c,method:i.method,confidence:i.confidence,similarity:i.similarity});let{error:m}=await y.from("theme_attempts").insert({player_id:e,theme:t,guess:r.trim(),is_correct:c,attempt_date:o,words_completed_when_guessed:n.completedWords,total_word_guesses:l,similarity_score:i.similarity||null,confidence_percentage:i.confidence,matching_method:i.method});if(m)return console.error("[submitThemeAttempt] Insert error:",m),{success:!1,isCorrect:!1,alreadyGuessedToday:!1,wordsCompleted:n.completedWords,totalGuesses:l};return{success:!0,isCorrect:c,alreadyGuessedToday:!1,wordsCompleted:n.completedWords,totalGuesses:l}}catch(e){return console.error("[submitThemeAttempt] Error:",e),{success:!1,isCorrect:!1,alreadyGuessedToday:!1,wordsCompleted:0,totalGuesses:0}}}async function g(e){try{let{data:t,error:r}=await y.from("theme_attempts").select("theme, is_correct, words_completed_when_guessed").eq("player_id",e);if(r)return console.error("[getPlayerThemeStats] Error:",r),{totalThemeAttempts:0,correctThemeGuesses:0,averageAttemptsPerTheme:0,averageWordsCompletedWhenGuessing:0,themesGuessed:[]};let o=t?.length||0,s=t?.filter(e=>e.is_correct).length||0,n=Array.from(new Set(t?.map(e=>e.theme)||[])),a=n.length>0?o/n.length:0,l=o>0?(t?.reduce((e,t)=>e+(t.words_completed_when_guessed||0),0)||0)/o:0;return{totalThemeAttempts:o,correctThemeGuesses:s,averageAttemptsPerTheme:Math.round(100*a)/100,averageWordsCompletedWhenGuessing:Math.round(100*l)/100,themesGuessed:t?.filter(e=>e.is_correct).map(e=>e.theme)||[]}}catch(e){return console.error("[getPlayerThemeStats] Error:",e),{totalThemeAttempts:0,correctThemeGuesses:0,averageAttemptsPerTheme:0,averageWordsCompletedWhenGuessing:0,themesGuessed:[]}}}async function p(e,t){try{let{monday:r,sunday:o}=_(),{data:s,error:n}=await y.from("words").select("id, word, date").eq("theme",t).gte("date",r.toISOString().split("T")[0]).lte("date",o.toISOString().split("T")[0]).order("date",{ascending:!0});if(n)return console.error("[getThemeProgress] Database error:",n),{totalWords:0,completedWords:0,themeGuess:null,canGuessTheme:!1,hasGuessedToday:!1,isCorrectGuess:!1,similarityScore:null,confidencePercentage:null,matchingMethod:null};let a=s?.map(e=>e.id)||[],{data:l,error:i}=await y.from("game_sessions").select("word_id, is_complete, is_won, is_archive_play").eq("player_id",e).in("word_id",a);if(i)return console.error("[getThemeProgress] Database error:",i),{totalWords:s?.length||0,completedWords:0,themeGuess:null,canGuessTheme:!1,hasGuessedToday:!1,isCorrectGuess:!1,similarityScore:null,confidencePercentage:null,matchingMethod:null};let d=l?.filter(e=>e.is_complete&&e.is_won&&!0!==e.is_archive_play)||[],{data:c,error:m}=await y.from("theme_attempts").select("guess, is_correct, similarity_score, confidence_percentage, matching_method, attempt_date").eq("player_id",e).eq("theme",t).gte("attempt_date",r.toISOString().split("T")[0]).lte("attempt_date",o.toISOString().split("T")[0]).order("attempt_date",{ascending:!1});m&&"PGRST116"!==m.code&&console.error("[getThemeProgress] Weekly attempts error:",m);let u=null;c&&c.length>0&&(u=c.find(e=>e.is_correct)||c[0]);let h=new Date().toISOString().split("T")[0],{data:g,error:p}=await y.from("theme_attempts").select("guess").eq("player_id",e).eq("theme",t).eq("attempt_date",h).single();p&&"PGRST116"!==p.code&&console.error("[getThemeProgress] Theme attempt error:",p);let w=d.length>0;return{totalWords:s?.length||0,completedWords:d.length,themeGuess:u?.guess||null,canGuessTheme:w&&!g,hasGuessedToday:!!g,isCorrectGuess:u?.is_correct||!1,similarityScore:u?.similarity_score||null,confidencePercentage:u?.confidence_percentage||null,matchingMethod:u?.matching_method||null}}catch(e){return console.error("[getThemeProgress] Error:",e),{totalWords:0,completedWords:0,themeGuess:null,canGuessTheme:!1,hasGuessedToday:!1,isCorrectGuess:!1,similarityScore:null,confidencePercentage:null,matchingMethod:null}}}function _(e=new Date){let t=c(e),r=m(e);return{monday:t,sunday:r}}async function w(e,t){try{let{monday:r,sunday:o}=_();console.log("[getAllWeeklyThemedWords] Getting all weekly themed words for player:",{playerId:e,theme:t,weekStart:r.toISOString().split("T")[0],weekEnd:o.toISOString().split("T")[0]});let{data:s,error:n}=await y.from("words").select("id, word, date").eq("theme",t).gte("date",r.toISOString().split("T")[0]).lte("date",o.toISOString().split("T")[0]).order("date",{ascending:!0});if(n)return console.error("[getAllWeeklyThemedWords] Error fetching themed words:",n),[];if(!s||0===s.length)return console.log("[getAllWeeklyThemedWords] No themed words found for current week"),[];let a=s.map(e=>e.id),{data:l,error:i}=await y.from("game_sessions").select("word_id, created_at, is_won, is_archive_play").eq("player_id",e).eq("is_complete",!0).eq("is_archive_play",!1).in("word_id",a);if(i)return console.error("[getAllWeeklyThemedWords] Error fetching completed sessions:",i),[];let d=s.map(e=>{let t=l?.find(t=>t.word_id===e.id&&!0===t.is_won);return{id:e.id,word:e.word,date:e.date,completedOn:t?.created_at||null,isCompleted:!!t}});return console.log("[getAllWeeklyThemedWords] Found all themed words:",{totalThemedWords:s.length,completedCount:d.filter(e=>e.isCompleted).length,missedCount:d.filter(e=>!e.isCompleted).length}),d}catch(e){return console.error("[getAllWeeklyThemedWords] Error:",e),[]}}async function f(e,t){try{let{monday:r,sunday:o}=_();console.log("[getPlayerWeeklyThemedWords] Getting weekly themed words for player:",{playerId:e,theme:t,weekStart:r.toISOString().split("T")[0],weekEnd:o.toISOString().split("T")[0]});let{data:s,error:n}=await y.from("words").select("id, word, date").eq("theme",t).gte("date",r.toISOString().split("T")[0]).lte("date",o.toISOString().split("T")[0]).order("date",{ascending:!0});if(n)return console.error("[getPlayerWeeklyThemedWords] Error fetching themed words:",n),[];if(!s||0===s.length)return console.log("[getPlayerWeeklyThemedWords] No themed words found for current week"),[];let a=s.map(e=>e.id),{data:l,error:i}=await y.from("game_sessions").select("word_id, created_at, end_time, is_won, is_archive_play").eq("player_id",e).eq("is_complete",!0).eq("is_archive_play",!1).in("word_id",a);if(i)return console.error("[getPlayerWeeklyThemedWords] Error fetching completed sessions:",i),[];let d=s.filter(e=>l?.some(t=>t.word_id===e.id)).map(e=>{let t=(l||[]).filter(t=>t.word_id===e.id),r=t.find(e=>!0===e.is_won),o=t.slice().sort((e,t)=>{let r=new Date(e.end_time||e.created_at).getTime();return new Date(t.end_time||t.created_at).getTime()-r})[0],s=r||o;return{id:e.id,word:e.word,date:e.date,completedOn:s?.created_at||e.date,wasWon:s?.is_won===!0}});return console.log("[getPlayerWeeklyThemedWords] Found completed themed words:",{totalThemedWords:s.length,completedCount:d.length,completedWords:d.map(e=>({word:e.word,date:e.date,wasWon:e.wasWon}))}),d}catch(e){return console.error("[getPlayerWeeklyThemedWords] Error:",e),[]}}o()}catch(e){o(e)}})},301:(e,t,r)=>{r.d(t,{bG:()=>o,oe:()=>s});let o=e=>e?e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[\u200B\u200D\u200C\uFEFF-]/g,""):"",s=(e,t)=>o(e)===o(t)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};