"use strict";(()=>{var e={};e.id=338,e.ids=[338],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1528:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>d,routeModule:()=>E});var n=t(1802),i=t(7153),s=t(6249),a=t(4655),l=e([a]);a=(l.then?(await l)():l)[0];let d=(0,s.l)(a,"default"),c=(0,s.l)(a,"config"),E=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/word",pathname:"/api/word",bundlePath:"",filename:""},userland:a});o()}catch(e){o(e)}})},7274:(e,r,t)=>{t.d(r,{o:()=>o});function o(e){return async(r,t)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===r.method){t.status(204).end();return}return e(r,t)}}},4655:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{default:()=>u});var n=t(2885),i=t(9085),s=t(7274),a=t(3092),l=t(8355),d=t(9462),c=e([i,a,d]);if([i,a,d]=c.then?(await c)():c,!i.O.SUPABASE_URL)throw console.error("❌ Missing SUPABASE_URL in env"),Error("Missing SUPABASE_URL");if(!i.O.SUPABASE_SERVICE_ROLE_KEY)throw console.error("❌ Missing SUPABASE_SERVICE_ROLE_KEY in env"),Error("Missing SUPABASE_SERVICE_ROLE_KEY");if(!i.O.DB_PROVIDER)throw console.error("❌ Missing DB_PROVIDER in env"),Error("Missing DB_PROVIDER");console.log("[/api/word] Environment validation passed:",{hasSupabaseUrl:!!i.O.SUPABASE_URL,hasServiceRoleKey:!!i.O.SUPABASE_SERVICE_ROLE_KEY,dbProvider:i.O.DB_PROVIDER,nodeEnv:i.O.NODE_ENV});let _=(0,n.createClient)(i.O.SUPABASE_URL,i.O.SUPABASE_SERVICE_ROLE_KEY);async function E(e,r){if("GET"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let t=e.headers["player-id"]??"anonymous";console.log("[/api/word] Using player ID:",t);try{await (0,d.Y0)(t)}catch(e){console.error("[/api/word] Failed to ensure player exists:",e)}let o=await (0,a.r)();if(!o?.word?.id)return console.error("[/api/word] Invalid word response:",o),r.status(500).json({error:"Failed to get valid word"});console.log("[/api/word] Creating game session:",{wordId:o.word.id,playerId:t});let n=new Date().toISOString(),i=(0,l.E6)();console.log("[/api/word] Initializing game session with:",{playerId:t,wordId:o.word.id,start_time:n,clue_status:i});let{data:s,error:c}=await _.from("game_sessions").insert({player_id:t,word_id:o.word.id,guesses:[],revealed_clues:[],clue_status:i,is_complete:!1,is_won:!1,start_time:n}).select("id, start_time").single();if(c)return console.error("[/api/word] Failed to create game session:",{error:c,details:c.details,hint:c.hint,code:c.code}),r.status(500).json({error:"Failed to create game session",details:c.message});r.status(200).json({...o,gameId:s.id,start_time:s.start_time})}catch(e){console.error("[/api/word] Error:",e),r.status(500).json({error:"Failed to get word"})}}let u=(0,s.o)(E);o()}catch(e){o(e)}})},6325:(e,r,t)=>{t.d(r,{T:()=>o});function o(e){let r=e.equivalents||[];return{id:e.id,word:e.word,definition:e.definition,first_letter:e.first_letter,in_a_sentence:e.in_a_sentence,equivalents:r,number_of_letters:e.number_of_letters,etymology:e.etymology,difficulty:e.difficulty,date:e.date}}},8355:(e,r,t)=>{t.d(r,{DD:()=>o,E6:()=>n,b6:()=>i});let o=["definition","equivalents","first_letter","in_a_sentence","number_of_letters","etymology"];function n(){return{definition:!1,equivalents:!1,first_letter:!1,in_a_sentence:!1,number_of_letters:!1,etymology:!1}}function i(e){if(e.length>o.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==o[r])return!1;return!0}if(6!==o.length)throw Error("CLUE_SEQUENCE must contain exactly 6 clues");if(new Set(o).size!==o.length)throw Error("CLUE_SEQUENCE contains duplicate clues");for(let[e,r]of Object.entries({D:"definition",E:"equivalents",F:"first_letter",I:"in_a_sentence",N:"number_of_letters",E2:"etymology"}))if(!o.includes(r))throw Error(`Invalid clue key mapping: ${e} -> ${r}`)},9085:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{O:()=>a});var n=t(9926),i=e([n]);let s=(n=(i.then?(await i)():i)[0]).z.object({SUPABASE_URL:n.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:n.z.string(),SUPABASE_ANON_KEY:n.z.string(),DB_PROVIDER:n.z.literal("supabase"),NODE_ENV:n.z.enum(["development","production"]).default("production"),PORT:n.z.string().transform(Number).default("3001"),FRONTEND_URL:n.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:process.env.SUPABASE_URL,SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:process.env.SUPABASE_ANON_KEY,DB_PROVIDER:process.env.DB_PROVIDER,NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!s.success)throw console.error("❌ Invalid environment variables:\n",Object.entries(s.error.flatten().fieldErrors).map(([e,r])=>`${e}: ${r?.join(", ")}`).join("\n")),Error("Invalid environment variables");let a=s.data;o()}catch(e){o(e)}})},3092:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{r:()=>l});var n=t(2885),i=t(9085),s=t(6325),a=e([i]);i=(a.then?(await a)():a)[0];let d=(0,n.createClient)(i.O.SUPABASE_URL,i.O.SUPABASE_SERVICE_ROLE_KEY);async function l(){try{let e=new Date,r=`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,{data:t,error:o}=await d.from("words").select(`
        id,
        word,
        definition,
        first_letter,
        in_a_sentence,
        equivalents,
        number_of_letters,
        etymology,
        difficulty,
        date
      `).eq("date",r).single();if(o)throw console.error("[getNewWord] Failed to get word of the day:",o),Error("Failed to get word of the day");if(!t)throw console.error("[getNewWord] No word found for today:",r),Error("No word found for today");return{word:(0,s.T)(t),isFallback:!1}}catch(e){throw console.error("[getNewWord] Error:",e),e}}o()}catch(e){o(e)}})},9462:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{Y0:()=>a});var n=t(2885),i=t(9085),s=e([i]);i=(s.then?(await s)():s)[0];let l=(0,n.createClient)(i.O.SUPABASE_URL,i.O.SUPABASE_SERVICE_ROLE_KEY);async function a(e){try{let{data:r,error:t}=await l.rpc("ensure_player_exists",{p_id:e});if(t)throw console.error("[ensurePlayerExists] Failed to ensure player:",t),t;return r}catch(e){throw console.error("[ensurePlayerExists] Unexpected error:",e),e}}o()}catch(e){o(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1528);module.exports=t})();