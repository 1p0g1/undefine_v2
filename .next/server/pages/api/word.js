"use strict";(()=>{var e={};e.id=338,e.ids=[338],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1528:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>d,routeModule:()=>E});var n=r(1802),i=r(7153),a=r(6249),s=r(4655),l=e([s]);s=(l.then?(await l)():l)[0];let d=(0,a.l)(s,"default"),c=(0,a.l)(s,"config"),E=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/word",pathname:"/api/word",bundlePath:"",filename:""},userland:s});o()}catch(e){o(e)}})},7274:(e,t,r)=>{r.d(t,{o:()=>o});function o(e){return async(t,r)=>{if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===t.method){r.status(204).end();return}return e(t,r)}}},4655:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>_});var n=r(2885),i=r(9085),a=r(7274),s=r(3092),l=r(8355),d=r(9462),c=e([i,s,d]);if([i,s,d]=c.then?(await c)():c,!i.O.SUPABASE_URL)throw console.error("❌ Missing SUPABASE_URL in env"),Error("Missing SUPABASE_URL");if(!i.O.SUPABASE_SERVICE_ROLE_KEY)throw console.error("❌ Missing SUPABASE_SERVICE_ROLE_KEY in env"),Error("Missing SUPABASE_SERVICE_ROLE_KEY");if(!i.O.DB_PROVIDER)throw console.error("❌ Missing DB_PROVIDER in env"),Error("Missing DB_PROVIDER");console.log("[/api/word] Environment validation passed:",{hasSupabaseUrl:!!i.O.SUPABASE_URL,hasServiceRoleKey:!!i.O.SUPABASE_SERVICE_ROLE_KEY,dbProvider:i.O.DB_PROVIDER,nodeEnv:i.O.NODE_ENV});let u=(0,n.createClient)(i.O.SUPABASE_URL,i.O.SUPABASE_SERVICE_ROLE_KEY);async function E(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let r=e.headers["player-id"]??"anonymous";console.log("[/api/word] Using player ID:",r);try{await (0,d.Y0)(r)}catch(e){console.error("[/api/word] Failed to ensure player exists:",e)}let o=await (0,s.r)();if(!o?.word?.id)return console.error("[/api/word] Invalid word response:",o),t.status(500).json({error:"Failed to get valid word"});console.log("[/api/word] Creating game session:",{wordId:o.word.id,playerId:r});let n=new Date().toISOString(),i=(0,l.E6)();console.log("[/api/word] Initializing game session with:",{playerId:r,wordId:o.word.id,start_time:n,clue_status:i});let{data:a,error:c}=await u.from("game_sessions").insert({player_id:r,word_id:o.word.id,guesses:[],revealed_clues:[],clue_status:i,is_complete:!1,is_won:!1,start_time:n}).select("id, start_time").single();if(c)return console.error("[/api/word] Failed to create game session:",{error:c,details:c.details,hint:c.hint,code:c.code}),t.status(500).json({error:"Failed to create game session",details:c.message});t.status(200).json({...o,gameId:a.id,start_time:a.start_time})}catch(e){console.error("[/api/word] Error:",e),t.status(500).json({error:"Failed to get word"})}}let _=(0,a.o)(E);o()}catch(e){o(e)}})},6325:(e,t,r)=>{r.d(t,{T:()=>o});function o(e){let t=e.equivalents||[];return{id:e.id,word:e.word,definition:e.definition,first_letter:e.first_letter,in_a_sentence:e.in_a_sentence,equivalents:t,number_of_letters:e.number_of_letters,etymology:e.etymology,difficulty:e.difficulty,date:e.date}}},8355:(e,t,r)=>{r.d(t,{DD:()=>o,E6:()=>n,b6:()=>i});let o=["definition","equivalents","first_letter","in_a_sentence","number_of_letters","etymology"];function n(){return{definition:!1,equivalents:!1,first_letter:!1,in_a_sentence:!1,number_of_letters:!1,etymology:!1}}function i(e){if(e.length>o.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0}if(6!==o.length)throw Error("CLUE_SEQUENCE must contain exactly 6 clues");if(new Set(o).size!==o.length)throw Error("CLUE_SEQUENCE contains duplicate clues");for(let[e,t]of Object.entries({D:"definition",E:"equivalents",F:"first_letter",I:"in_a_sentence",N:"number_of_letters",E2:"etymology"}))if(!o.includes(t))throw Error(`Invalid clue key mapping: ${e} -> ${t}`)},9085:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{O:()=>s});var n=r(9926),i=e([n]);let a=(n=(i.then?(await i)():i)[0]).z.object({SUPABASE_URL:n.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:n.z.string(),SUPABASE_ANON_KEY:n.z.string(),DB_PROVIDER:n.z.literal("supabase"),NODE_ENV:n.z.enum(["development","production"]).default("production"),PORT:n.z.string().transform(Number).default("3001"),FRONTEND_URL:n.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:"https://eaclljwvsicezmkjnlbm.supabase.co",SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjk3NzIsImV4cCI6MjA1OTYwNTc3Mn0.56sdQFmC4sNAbyenWoDeiA",DB_PROVIDER:"supabase",NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!a.success)throw console.error("❌ Invalid environment variables:\n",Object.entries(a.error.flatten().fieldErrors).map(([e,t])=>`${e}: ${t?.join(", ")}`).join("\n")),Error("Invalid environment variables");let s=a.data;o()}catch(e){o(e)}})},3092:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{r:()=>l});var n=r(2885),i=r(9085),a=r(6325),s=e([i]);i=(s.then?(await s)():s)[0];let d=(0,n.createClient)(i.O.SUPABASE_URL,i.O.SUPABASE_SERVICE_ROLE_KEY);async function l(){try{let e=new Date,t=`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`;console.log("[getNewWord] Looking for word for date:",t);let{data:r,error:o}=await d.from("words").select(`
        id,
        word,
        definition,
        first_letter,
        in_a_sentence,
        equivalents,
        number_of_letters,
        etymology,
        difficulty,
        date,
        theme
      `).eq("date",t).single();if(!o&&r)return console.log("[getNewWord] Found word for today:",r.word),{word:(0,a.T)(r),isFallback:!1};console.log("[getNewWord] No word found for today, falling back to most recent word");let{data:n,error:i}=await d.from("words").select(`
        id,
        word,
        definition,
        first_letter,
        in_a_sentence,
        equivalents,
        number_of_letters,
        etymology,
        difficulty,
        date
      `).order("date",{ascending:!1}).limit(1).single();if(i||!n)throw console.error("[getNewWord] Failed to get fallback word:",i),Error("No words available in database");return console.log("[getNewWord] Using fallback word:",n.word,"from date:",n.date),{word:(0,a.T)(n),isFallback:!0}}catch(e){throw console.error("[getNewWord] Error:",e),e}}o()}catch(e){o(e)}})},9462:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Y0:()=>s});var n=r(2885),i=r(9085),a=e([i]);i=(a.then?(await a)():a)[0];let l=(0,n.createClient)(i.O.SUPABASE_URL,i.O.SUPABASE_SERVICE_ROLE_KEY);async function s(e){try{let{data:t,error:r}=await l.rpc("ensure_player_exists",{p_id:e});if(r)throw console.error("[ensurePlayerExists] Failed to ensure player:",r),r;return t}catch(e){throw console.error("[ensurePlayerExists] Unexpected error:",e),e}}o()}catch(e){o(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=1528);module.exports=r})();