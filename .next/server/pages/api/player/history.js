"use strict";(()=>{var e={};e.id=532,e.ids=[532],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},2237:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>c,routeModule:()=>y});var a={};r.r(a),r.d(a,{default:()=>u});var o=r(1802),n=r(7153),s=r(6249),i=r(2885),l=r(7274);let d=(0,i.createClient)(process.env.SUPABASE_URL,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY"),u=(0,l.o)(async function(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{player_id:r,months:a=2}=e.query;if(!r)return t.status(400).json({error:"Player ID is required"});try{console.log("[/api/player/history] Fetching play history for player:",r);let e=new Date,o=new Date;o.setMonth(e.getMonth()-parseInt(a));let n=o.toISOString().split("T")[0],s=e.toISOString().split("T")[0],{data:i,error:l}=await d.from("game_sessions").select(`
        id,
        word_id,
        is_complete,
        is_won,
        is_archive_play,
        game_date,
        end_time,
        guesses,
        words (
          word,
          date
        )
      `).eq("player_id",r).eq("is_complete",!0).eq("is_archive_play",!1).gte("game_date",n).lte("game_date",s).order("game_date",{ascending:!0});if(l)return console.error("[/api/player/history] Error fetching game sessions:",l),t.status(500).json({error:"Failed to fetch play history"});let{data:u,error:c}=await d.from("leaderboard_summary").select("date, rank, guesses_used, best_time").eq("player_id",r).gte("date",n).lte("date",s);c&&console.warn("[/api/player/history] Warning fetching leaderboard data:",c);let p=new Map;u?.forEach(e=>{p.set(e.date,e.rank)});let y=new Map;i?.forEach(e=>{let t=e.game_date||e.words?.date;if(t){let r=y.get(t);(!r||new Date(e.end_time)>new Date(r.end_time))&&y.set(t,e)}});let g=Array.from(y.entries()).map(([e,t])=>({date:e,played:!0,won:t.is_won,rank:t.is_won?p.get(e):void 0,guesses:t.guesses?.length||0,word:t.words?.word||"Unknown"}));return g.sort((e,t)=>e.date.localeCompare(t.date)),console.log(`[/api/player/history] Found ${g.length} play records (${g.filter(e=>e.won).length} wins, ${g.filter(e=>!e.won).length} losses)`),t.status(200).json({history:g,dateRange:{start:n,end:s}})}catch(e){return console.error("[/api/player/history] Unexpected error:",e),t.status(500).json({error:"Internal server error"})}}),c=(0,s.l)(a,"default"),p=(0,s.l)(a,"config"),y=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/player/history",pathname:"/api/player/history",bundlePath:"",filename:""},userland:a})},7274:(e,t,r)=>{r.d(t,{o:()=>a});function a(e){return async(t,r)=>{if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===t.method){r.status(204).end();return}return e(t,r)}}},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2237);module.exports=r})();