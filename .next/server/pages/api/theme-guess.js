"use strict";(()=>{var e={};e.id=552,e.ids=[552],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},9209:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{config:()=>l,default:()=>d,routeModule:()=>m});var a=t(1802),o=t(7153),i=t(6249),u=t(2042),n=e([u]);u=(n.then?(await n)():n)[0];let d=(0,i.l)(u,"default"),l=(0,i.l)(u,"config"),m=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/theme-guess",pathname:"/api/theme-guess",bundlePath:"",filename:""},userland:u});r()}catch(e){r(e)}})},2042:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{default:()=>l});var a=t(2885),o=t(9085),i=t(7274),u=t(4229),n=e([o,u]);[o,u]=n.then?(await n)():n;let d=(0,a.createClient)(o.O.SUPABASE_URL,o.O.SUPABASE_SERVICE_ROLE_KEY),l=(0,i.o)(async function(e,s){if("POST"!==e.method)return s.status(405).json({error:"Method not allowed"});try{let{player_id:t,guess:r,gameId:a}=e.body;if(console.log("[/api/theme-guess] Processing theme guess:",{player_id:t,guess:r,gameId:a}),!t||!r||!a){let e=[];return t||e.push("player_id"),r||e.push("guess"),a||e.push("gameId"),s.status(400).json({error:"Missing required fields",details:{missing:e}})}let{data:o,error:i}=await d.from("game_sessions").select("id, player_id, word_id, theme_guess").eq("id",a).eq("player_id",t).single();if(i||!o)return console.error("[/api/theme-guess] Game session not found:",i),s.status(404).json({error:"Game session not found",details:i?.message});if(o.theme_guess)return s.status(400).json({error:"Theme guess already submitted",details:{existingGuess:o.theme_guess}});let n=await (0,u.gz)();if(!n)return s.status(400).json({error:"No active theme for this week"});console.log("[/api/theme-guess] Submitting theme attempt:",{guess:r,currentTheme:n});let l=await (0,u.nu)(r,n);console.log("[/api/theme-guess] Fuzzy matching result:",l);let m=await (0,u.s6)(t,n,r);if(!m.success){if(m.alreadyGuessedToday)return s.status(400).json({error:"Already guessed today",details:{message:"You can only make one theme guess per day"}});return s.status(500).json({error:"Failed to submit theme attempt"})}let c=await (0,u.Gu)(t,n);console.log("[/api/theme-guess] Theme guess processed:",{isCorrect:m.isCorrect,guess:r,currentTheme:n,progress:c,fuzzyMatch:l});let g={isCorrect:m.isCorrect,guess:r.trim(),progress:c,fuzzyMatch:{method:l.method,confidence:l.confidence,similarity:l.similarity}};return m.isCorrect&&(g.actualTheme=n),s.status(200).json(g)}catch(e){return console.error("[/api/theme-guess] Error:",e),s.status(500).json({error:"Failed to process theme guess",details:e instanceof Error?e.message:"Unknown error"})}});r()}catch(e){r(e)}})}};var s=require("../../webpack-api-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[58],()=>t(9209));module.exports=r})();