"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},604:(e,r,t)=>{t.r(r),t.d(r,{config:()=>p,default:()=>g,routeModule:()=>_});var s={};t.r(s),t.d(s,{default:()=>m});var a=t(1802),l=t(7153),o=t(6249),n=t(2885),i=t(7274);let d=(0,n.createClient)(process.env.SUPABASE_URL,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY");async function u(e,r){if("GET"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});try{console.log("[All-Time API] Starting all-time leaderboard request");let{data:e,error:t}=await d.from("leaderboard_summary").select(`
        player_id,
        rank,
        guesses_used,
        date,
        was_top_10
      `).order("date",{ascending:!1});if(t)return console.error("[All-Time API] Leaderboard query error:",t),r.status(500).json({success:!1,error:"Leaderboard query failed",debug:t});console.log(`[All-Time API] Found ${e?.length||0} leaderboard records`);let s=Array.from(new Set((e||[]).map(e=>e.player_id).filter(e=>e&&"null"!==e&&"undefined"!==e)));console.log(`[All-Time API] Found ${s.length} unique players`);let{data:a,error:l}=await d.from("players").select("id, display_name").in("id",s);l&&console.error("[All-Time API] Players query error:",l),console.log(`[All-Time API] Found ${a?.length||0} player records`);let o=(a||[]).reduce((e,r)=>(r.display_name&&(e[r.id]=r.display_name),e),{}),{data:n,error:i}=await d.from("player_streaks").select("player_id, highest_streak, current_streak");i&&console.error("[All-Time API] Streak query error:",i),console.log(`[All-Time API] Found ${n?.length||0} streak records`);let u=(n||[]).reduce((e,r)=>(e[r.player_id]=r,e),{}),m=await c(u,o);console.log(`[All-Time API] Calculated stats for ${m.length} players`);let g=[...m].filter(e=>e.total_games>=1).sort((e,r)=>r.total_games-e.total_games).slice(0,10),p=[...m].filter(e=>e.highest_streak>0).sort((e,r)=>r.highest_streak-e.highest_streak).slice(0,10),_=m.length,A=m.reduce((e,r)=>e+r.total_games,0);return console.log(`[All-Time API] Returning data: ${g.length} top games, ${p.length} top streaks`),r.status(200).json({success:!0,data:{topByStreaks:p,topByGames:g,totalPlayers:_,totalGames:A}})}catch(e){return console.error("[All-Time API] Unexpected error:",e),r.status(500).json({success:!1,error:"Internal server error",debug:e instanceof Error?e.message:"Unknown error"})}}async function c(e,r){let{data:t,error:s}=await d.from("game_sessions").select("player_id, is_won, guesses, start_time, end_time, word_id").eq("is_complete",!0);return s?(console.error("[calculateAllTimeStatsFromSessions] Error:",s),[]):Object.entries((t||[]).reduce((e,r)=>{let t=r.player_id;return t&&"null"!==t&&"undefined"!==t&&(e[t]||(e[t]={wins:[],losses:[],totalGames:0}),r.is_won?e[t].wins.push(r):e[t].losses.push(r),e[t].totalGames++),e},{})).map(([t,s])=>{let{wins:a,losses:l,totalGames:o}=s,n=a.length,i=n>0?a.reduce((e,r)=>e+(r.guesses?r.guesses.length:0),0)/n:0,d=[...a,...l],u=d.length>0?d.sort((e,r)=>new Date(r.start_time).getTime()-new Date(e.start_time).getTime())[0].start_time.split("T")[0]:"",c=r[t]||`Player ${t.slice(-4)}`,m=e[t];return{player_id:t,player_name:c,win_percentage:Math.round(100*(o>0?n/o*100:0))/100,average_guesses:Math.round(100*i)/100,highest_streak:m?.highest_streak||0,current_streak:m?.current_streak||0,total_games:o,total_wins:n,last_played:u}})}let m=(0,i.o)(u),g=(0,o.l)(s,"default"),p=(0,o.l)(s,"config"),_=new a.PagesAPIRouteModule({definition:{kind:l.x.PAGES_API,page:"/api/leaderboard/all-time",pathname:"/api/leaderboard/all-time",bundlePath:"",filename:""},userland:s})},7274:(e,r,t)=>{t.d(r,{o:()=>s});function s(e){return async(r,t)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===r.method){t.status(204).end();return}return e(r,t)}}},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=604);module.exports=t})();