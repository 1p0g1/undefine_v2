"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1438:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>d,default:()=>c,routeModule:()=>u});var s=t(1802),n=t(7153),i=t(6249),o=t(4991),l=e([o]);o=(l.then?(await l)():l)[0];let c=(0,i.l)(o,"default"),d=(0,i.l)(o,"config"),u=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/leaderboard/all-time",pathname:"/api/leaderboard/all-time",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},7274:(e,r,t)=>{t.d(r,{o:()=>a});function a(e){return async(r,t)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===r.method){t.status(204).end();return}return e(r,t)}}},4991:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>c});var s=t(3845),n=t(7274),i=e([s]);async function o(e,r){if("GET"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});try{let{data:e,error:t}=await s.O.from("leaderboard_summary").select(`
        player_id,
        rank,
        guesses_used,
        date,
        was_top_10
      `).order("date",{ascending:!1});if(t)return console.error("[All-Time API] Leaderboard query error:",t),r.status(500).json({success:!1,error:"Leaderboard query failed",debug:t});let a=Array.from(new Set((e||[]).map(e=>e.player_id).filter(e=>e&&"null"!==e&&"undefined"!==e))),{data:n,error:i}=await s.O.from("players").select("id, display_name").in("id",a);i&&console.error("[All-Time API] Players query error:",i);let o=(n||[]).reduce((e,r)=>(r.display_name&&(e[r.id]=r.display_name),e),{}),{data:c,error:d}=await s.O.from("player_streaks").select("player_id, highest_streak, current_streak");d&&console.error("[All-Time API] Streak query error:",d);let u=(c||[]).reduce((e,r)=>(e[r.player_id]=r,e),{}),_=await l(u,o),m=[..._].filter(e=>e.total_games>=1).sort((e,r)=>r.total_games-e.total_games).slice(0,10),p=[..._].filter(e=>e.highest_streak>0).sort((e,r)=>r.highest_streak-e.highest_streak).slice(0,10),A=_.length,I=_.reduce((e,r)=>e+r.total_games,0);return r.status(200).json({success:!0,data:{topByStreaks:p,topByGames:m,totalPlayers:A,totalGames:I}})}catch(e){return console.error("[All-Time API] Unexpected error:",e),r.status(500).json({success:!1,error:"Internal server error",debug:e instanceof Error?e.message:"Unknown error"})}}async function l(e,r){let{data:t,error:a}=await s.O.from("game_sessions").select("player_id, is_won, guesses, start_time, end_time, word_id").eq("is_complete",!0);if(a)return console.error("[calculateAllTimeStatsFromSessions] Error:",a),[];let n=(t||[]).reduce((e,r)=>{let t=r.player_id;return t&&"null"!==t&&"undefined"!==t&&(e[t]||(e[t]={wins:[],losses:[],totalGames:0}),r.is_won?e[t].wins.push(r):e[t].losses.push(r),e[t].totalGames++),e},{});return Object.entries(n).map(([t,a])=>{let{wins:s,losses:n,totalGames:i}=a,o=s.length,l=o>0?s.reduce((e,r)=>e+(r.guesses?r.guesses.length:0),0)/o:0,c=[...s,...n],d=c.length>0?c.sort((e,r)=>new Date(r.start_time).getTime()-new Date(e.start_time).getTime())[0].start_time.split("T")[0]:"",u=r[t]||`Player ${t.slice(-4)}`,_=e[t],m=_?.highest_streak||0,p=_?.current_streak||0;return{player_id:t,player_name:u,win_percentage:Math.round(100*(i>0?o/i*100:0))/100,average_guesses:Math.round(100*l)/100,highest_streak:m,current_streak:p,total_games:i,total_wins:o,last_played:d}})}s=(i.then?(await i)():i)[0];let c=(0,n.o)(o);a()}catch(e){a(e)}})},9085:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{O:()=>o});var s=t(9926),n=e([s]);let i=(s=(n.then?(await n)():n)[0]).z.object({SUPABASE_URL:s.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:s.z.string(),SUPABASE_ANON_KEY:s.z.string(),DB_PROVIDER:s.z.literal("supabase"),NODE_ENV:s.z.enum(["development","production"]).default("production"),PORT:s.z.string().transform(Number).default("3001"),FRONTEND_URL:s.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:"https://eaclljwvsicezmkjnlbm.supabase.co",SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjk3NzIsImV4cCI6MjA1OTYwNTc3Mn0.56sdQFmC4sNAbyenWoDeiA",DB_PROVIDER:"supabase",NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!i.success)throw console.error("❌ Invalid environment variables:\n",Object.entries(i.error.flatten().fieldErrors).map(([e,r])=>`${e}: ${r?.join(", ")}`).join("\n")),Error("Invalid environment variables");let o=i.data;a()}catch(e){a(e)}})},3845:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{O:()=>o});var s=t(2885),n=t(9085),i=e([n]);n=(i.then?(await i)():i)[0];let o=(0,s.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_SERVICE_ROLE_KEY);a()}catch(e){a(e)}})},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1438);module.exports=t})();