"use strict";(()=>{var e={};e.id=310,e.ids=[310],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},6249:(e,s)=>{Object.defineProperty(s,"l",{enumerable:!0,get:function(){return function e(s,r){return r in s?s[r]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,r)):"function"==typeof s&&"default"===r?s:void 0}}})},141:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.r(s),r.d(s,{config:()=>c,default:()=>d,routeModule:()=>u});var o=r(1802),n=r(7153),a=r(6249),i=r(5274),l=e([i]);i=(l.then?(await l)():l)[0];let d=(0,a.l)(i,"default"),c=(0,a.l)(i,"config"),u=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/guess",pathname:"/api/guess",bundlePath:"",filename:""},userland:i});t()}catch(e){t(e)}})},7274:(e,s,r)=>{r.d(s,{o:()=>t});function t(e){return async(s,r)=>{if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===s.method){r.status(204).end();return}return e(s,r)}}},5274:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.r(s),r.d(s,{default:()=>h});var o=r(2885),n=r(9085);r(8355);var a=r(7274),i=r(4950),l=r(301),d=r(3562),c=r(9462),u=e([n,c]);if([n,c]=u.then?(await u)():u,!n.O.SUPABASE_URL)throw console.error("❌ Missing SUPABASE_URL in env"),Error("Missing SUPABASE_URL");if(!n.O.SUPABASE_SERVICE_ROLE_KEY)throw console.error("❌ Missing SUPABASE_SERVICE_ROLE_KEY in env"),Error("Missing SUPABASE_SERVICE_ROLE_KEY");if(!n.O.DB_PROVIDER)throw console.error("❌ Missing DB_PROVIDER in env"),Error("Missing DB_PROVIDER");console.log("[/api/guess] Environment validation passed:",{hasSupabaseUrl:!!n.O.SUPABASE_URL,hasServiceRoleKey:!!n.O.SUPABASE_SERVICE_ROLE_KEY,dbProvider:n.O.DB_PROVIDER,nodeEnv:n.O.NODE_ENV});let p=(0,o.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_SERVICE_ROLE_KEY);async function g(e,s,r,t,o,n){if(!t)throw Error("Completion time is required for creating score entry");console.log("[createScoreEntry] Using NEW scoring system:",{playerId:e,wordId:s,guessesUsed:r,completionTimeSeconds:t,isWon:o,scoreBreakdown:{baseScore:n.baseScore,fuzzyBonus:n.fuzzyBonus,timePenalty:n.timePenalty,hintPenalty:n.hintPenalty,finalScore:n.score}});let{error:a}=await p.from("scores").insert([{player_id:e,word_id:s,guesses_used:r,completion_time_seconds:t,correct:o,score:n.score,base_score:n.baseScore,guess_penalty:n.guessPenalty,fuzzy_bonus:n.fuzzyBonus,time_penalty:n.timePenalty,hint_penalty:n.hintPenalty,submitted_at:new Date().toISOString()}]);if(a)throw console.error("[createScoreEntry] Failed to create score:",a),a;console.log("[createScoreEntry] Successfully stored score with NEW system")}async function m(e,s,r,t,o){if(!t)throw Error("Completion time is required for updating leaderboard");console.log("[updateLeaderboardSummary] Starting leaderboard update:",{playerId:e,wordId:s,guessesUsed:r,completionTimeSeconds:t,score:o.score});try{await (0,c.Y0)(e),console.log("[/api/guess] ✅ Step 1 completed: Player existence confirmed"),console.log("[/api/guess] Leaderboard will be updated by database trigger")}catch(r){throw console.error("[/api/guess] Error in leaderboard update:",{error:r,message:r instanceof Error?r.message:"Unknown error",playerId:e,wordId:s,scoreResult:o}),r}}async function f(e,s){let t=(0,l.bG)(s),o=0,{advancedFuzzyMatch:n}=await Promise.resolve().then(r.bind(r,5302));for(let s of e){let e=(0,l.bG)(s);if(e!==t)try{let s=await n(e,t);s.isFuzzy&&(o++,console.log("[countFuzzyMatches] Fuzzy match found:",{guess:e,target:t,method:s.method,confidence:s.confidence,explanation:s.explanation}))}catch(s){console.warn("[countFuzzyMatches] Error checking fuzzy match:",s),function(e,s){let r=0,t=s.split("");for(let s of e){let e=t.indexOf(s);-1!==e&&(r++,t.splice(e,1))}return r/Math.max(e.length,s.length)>=.4&&r>=2}(e,t)&&(o++,console.log("[countFuzzyMatches] Legacy fuzzy match found:",{guess:e,target:t,method:"legacy_character_overlap"}))}}return o}let h=(0,a.o)(async function(e,s){if("POST"!==e.method)return s.status(405).json({error:"Method not allowed"});try{let{guess:r,gameId:t,wordId:o,start_time:n}=e.body,a=e.headers["player-id"]??"anonymous";if(console.log("[/api/guess] Processing guess:",{guess:r,gameId:t,playerId:a,wordId:o}),!t||!o||!n||!r||!a){let e={gameId:t,wordId:o,playerId:a,guess:r,start_time:n},i=Object.entries(e).filter(([e,s])=>!s).map(([e,s])=>e);return console.error("[/api/guess] Missing required fields:",i),s.status(400).json({error:"Missing required fields",details:{missing:i,received:e,required:["gameId","wordId","playerId","guess","start_time"]}})}if("string"!=typeof r||0===r.trim().length)return s.status(400).json({error:"Invalid guess format",details:{guess:r,expected:"non-empty string"}});if("string"!=typeof t||"string"!=typeof o)return s.status(400).json({error:"Invalid ID format",details:{gameId:t,wordId:o,expected:"string UUIDs"}});if("string"!=typeof n||!Date.parse(n))return s.status(400).json({error:"Invalid start_time format",details:{start_time:n,expected:"ISO date string"}});console.log("[/api/guess] Looking for game session:",{gameId:t,wordId:o,playerId:a});let{data:l,error:u}=await p.from("game_sessions").select("id, player_id, word_id, start_time, created_at").eq("player_id",a).order("created_at",{ascending:!1}).limit(5);console.log("[/api/guess] Recent sessions for player:",{playerId:a,sessionCount:l?.length||0,sessions:l,allError:u?.message});let{data:h,error:y}=await p.from("game_sessions").select("*").eq("id",t).single();console.log("[/api/guess] Session lookup by gameId only:",{found:!!h,sessionPlayerId:h?.player_id,requestPlayerId:a,playerMatch:h?.player_id===a,anyError:y?.message});let{data:_,error:w}=await p.from("game_sessions").select("*").eq("id",t).eq("player_id",a).single();if(console.log("[/api/guess] Session lookup with player validation:",{hasBasicSession:!!_,basicSessionId:_?.id,basicSessionWordId:_?.word_id,basicSessionPlayerId:_?.player_id,basicError:w?.message}),w){if(console.error("[/api/guess] Session lookup failed:",{error:w,code:w.code,details:w.details,hint:w.hint,gameId:t,wordId:o,playerId:a,sessionExistsButWrongPlayer:!!h&&h.player_id!==a}),h&&h.player_id!==a)return s.status(403).json({error:"Session belongs to different player",details:{gameId:t,sessionPlayerId:h.player_id,requestPlayerId:a}});return s.status(404).json({error:"Game session not found",details:{gameId:t,playerId:a,error:w.message,code:w.code,allSessions:l?.length||0}})}if(!_)return s.status(404).json({error:"Game session not found",details:{gameId:t,playerId:a,allSessions:l?.length||0,sessionExistsButWrongPlayer:!!h}});if(_.word_id!==o)return console.error("[/api/guess] Word ID mismatch:",{sessionWordId:_.word_id,requestWordId:o}),s.status(404).json({error:"Word ID mismatch",details:{sessionWordId:_.word_id,requestWordId:o}});let{data:E,error:S}=await p.from("game_sessions").select(`
        id,
        word_id,
        revealed_clues,
        guesses,
        is_complete,
        start_time,
        clue_status,
        words (
          word,
          definition,
          etymology,
          first_letter,
          in_a_sentence,
          number_of_letters,
          equivalents,
          difficulty,
          date
        )
      `).eq("id",t).single();if(console.log("[/api/guess] Full session with join result:",{hasGameSession:!!E,sessionError:S?.message,sessionErrorCode:S?.code,sessionErrorDetails:S?.details,gameSessionWordId:E?.word_id}),S||!E){if(console.error("[/api/guess] Failed to fetch game session with join:",{error:S,details:S?.details,hint:S?.hint,code:S?.code,gameId:t,wordId:o,playerId:a,basicSessionExists:!!_,basicSessionWordId:_?.word_id}),_){console.log("[/api/guess] Basic session exists, trying without words join...");let{data:e,error:o}=await p.from("words").select("word, definition, etymology, first_letter, in_a_sentence, number_of_letters, equivalents, difficulty, date").eq("id",_.word_id).single();if(console.log("[/api/guess] Word lookup result:",{hasWord:!!e,wordError:o?.message,wordId:_.word_id}),o||!e)return s.status(500).json({error:"Failed to fetch word data",details:{wordId:_.word_id,wordError:o?.message}});let l={..._,words:e};if(console.log("[/api/guess] Using combined session data"),l.is_complete)return s.status(400).json({error:"Game session is already complete"});if(l.start_time!==n)return console.error("[/api/guess] Start time mismatch:",{session:l.start_time,request:n}),s.status(400).json({error:"Invalid start time",details:"Start time does not match game session"});let u=await (0,i.E)({guess:r,gameId:t,playerId:a,wordId:l.word_id,start_time:l.start_time},l.words.word,l.revealed_clues||[],l.words),h=u.gameOver?Math.floor((Date.now()-new Date(l.start_time).getTime())/1e3):null,y=[...l.guesses||[],u.guess],w=await f(l.guesses||[],l.words.word),E=u.gameOver?(0,d.m)({guessesUsed:y.length,fuzzyMatches:w+(u.isFuzzy?1:0),completionTimeSeconds:h||0,usedHint:!1,isWon:u.isCorrect}):null,S={guesses:[...l.guesses||[],u.guess],revealed_clues:u.revealedClues,clue_status:u.revealedClues.reduce((e,s)=>({...e,[s]:!0}),l.clue_status||{}),is_complete:u.gameOver,is_won:u.isCorrect,end_time:u.gameOver?new Date().toISOString():null,updated_at:new Date().toISOString()};console.log("[/api/guess] Updating session with data:",{gameId:t,updateData:S,originalGuesses:l.guesses,newGuess:u.guess});let{error:I}=await p.from("game_sessions").update(S).eq("id",t);if(I)return console.error("[/api/guess] Failed to update game session:",{error:I,message:I.message,code:I.code,details:I.details,hint:I.hint,gameId:t,updateData:S}),s.status(500).json({error:"Failed to update game session",details:{message:I.message,code:I.code}});if(u.gameOver&&h&&E){let e;console.log("[/api/guess] Game completed, updating stats and scores:",{playerId:a,isCorrect:u.isCorrect,guessesUsed:l.guesses.length+1,completionTimeSeconds:h,scoreResult:{score:E.score,baseScore:E.baseScore,fuzzyBonus:E.fuzzyBonus,timePenalty:E.timePenalty,hintPenalty:E.hintPenalty}});try{if(!a)return console.error("[/api/guess] Missing player ID"),s.status(200).json({...u,score:E,stats:void 0});console.log("[/api/guess] Step 1: Ensuring player exists for player ID:",a);try{await (0,c.Y0)(a),console.log("[/api/guess] ✅ Step 1 completed: Player existence confirmed")}catch(e){return console.error("[/api/guess] ❌ Step 1 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a}),s.status(200).json({...u,score:E,stats:void 0})}if(!l?.word_id)return console.error("[/api/guess] Missing word_id in session"),s.status(200).json({...u,score:E,stats:void 0});if("number"!=typeof h||h<0)return console.error("[/api/guess] Invalid completion time:",h),s.status(200).json({...u,score:E,stats:void 0});console.log("[/api/guess] Step 2: Ensuring player FK record");try{await (0,c.Y0)(a),e=void 0,console.log("[/api/guess] ✅ Step 2 completed: Player FK record ensured")}catch(e){throw console.error("[/api/guess] ❌ Step 2 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:l.word_id}),e}console.log("[/api/guess] Step 3: Creating score entry");try{await g(a,l.word_id,l.guesses.length+1,h,u.isCorrect,E),console.log("[/api/guess] ✅ Step 3 completed: Score entry created successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 3 failed: createScoreEntry error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:l.word_id,scoreResult:E}),e}console.log("[/api/guess] Step 4: Updating leaderboard summary");try{await m(a,l.word_id,l.guesses.length+1,h,E),console.log("[/api/guess] ✅ Step 4 completed: Leaderboard updated successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 4 failed: updateLeaderboardSummary error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:l.word_id,scoreResult:E}),e}return console.log("[/api/guess] \uD83C\uDF89 All completion steps successful! Game stats and leaderboard updated."),s.status(200).json({...u,score:E,stats:e})}catch(e){return console.error("[/api/guess] \uD83D\uDCA5 Final catch: Failed in completion logic:",{error:e,message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,playerId:a,wordId:l.word_id,scoreResult:E,step:"unknown"}),s.status(200).json({...u,score:E,stats:void 0})}}return s.status(200).json(u)}return s.status(404).json({error:"Game session not found",details:"Invalid game session or word ID"})}if(E.is_complete)return s.status(400).json({error:"Game session is already complete"});if(E.start_time!==n)return console.error("[/api/guess] Start time mismatch:",{session:E.start_time,request:n}),s.status(400).json({error:"Invalid start time",details:"Start time does not match game session"});let I=await (0,i.E)({guess:r,gameId:t,playerId:a,wordId:E.word_id,start_time:E.start_time},E.words.word,E.revealed_clues||[],E.words),v=I.gameOver?Math.floor((Date.now()-new Date(E.start_time).getTime())/1e3):null,b=[...E.guesses||[],I.guess],P=await f(E.guesses||[],E.words.word),z=I.gameOver?(0,d.m)({guessesUsed:b.length,fuzzyMatches:P+(I.isFuzzy?1:0),completionTimeSeconds:v||0,usedHint:!1,isWon:I.isCorrect}):null,A={guesses:[...E.guesses||[],I.guess],revealed_clues:I.revealedClues,clue_status:I.revealedClues.reduce((e,s)=>({...e,[s]:!0}),E.clue_status||{}),is_complete:I.gameOver,is_won:I.isCorrect,end_time:I.gameOver?new Date().toISOString():null,updated_at:new Date().toISOString()};console.log("[/api/guess] Updating session with data:",{gameId:t,updateData:A,originalGuesses:E.guesses,newGuess:I.guess});let{error:O}=await p.from("game_sessions").update(A).eq("id",t);if(O)return console.error("[/api/guess] Failed to update game session:",{error:O,message:O.message,code:O.code,details:O.details,hint:O.hint,gameId:t,updateData:A}),s.status(500).json({error:"Failed to update game session",details:{message:O.message,code:O.code}});if(I.gameOver&&v&&z){let e;console.log("[/api/guess] Game completed, updating stats and scores:",{playerId:a,isCorrect:I.isCorrect,guessesUsed:E.guesses.length+1,completionTimeSeconds:v,scoreResult:{score:z.score,baseScore:z.baseScore,fuzzyBonus:z.fuzzyBonus,timePenalty:z.timePenalty,hintPenalty:z.hintPenalty}});try{if(!a)return console.error("[/api/guess] Missing player ID"),s.status(200).json({...I,score:z,stats:void 0});console.log("[/api/guess] Step 1: Ensuring player exists for player ID:",a);try{await (0,c.Y0)(a),console.log("[/api/guess] ✅ Step 1 completed: Player existence confirmed")}catch(e){return console.error("[/api/guess] ❌ Step 1 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a}),s.status(200).json({...I,score:z,stats:void 0})}if(!E?.word_id)return console.error("[/api/guess] Missing word_id in session"),s.status(200).json({...I,score:z,stats:void 0});if("number"!=typeof v||v<0)return console.error("[/api/guess] Invalid completion time:",v),s.status(200).json({...I,score:z,stats:void 0});console.log("[/api/guess] Step 2: Ensuring player FK record");try{await (0,c.Y0)(a),e=void 0,console.log("[/api/guess] ✅ Step 2 completed: Player FK record ensured")}catch(e){throw console.error("[/api/guess] ❌ Step 2 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:E.word_id}),e}console.log("[/api/guess] Step 3: Creating score entry");try{await g(a,E.word_id,E.guesses.length+1,v,I.isCorrect,z),console.log("[/api/guess] ✅ Step 3 completed: Score entry created successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 3 failed: createScoreEntry error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:E.word_id,scoreResult:z}),e}console.log("[/api/guess] Step 4: Updating leaderboard summary");try{await m(a,E.word_id,E.guesses.length+1,v,z),console.log("[/api/guess] ✅ Step 4 completed: Leaderboard updated successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 4 failed: updateLeaderboardSummary error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:E.word_id,scoreResult:z}),e}return console.log("[/api/guess] \uD83C\uDF89 All completion steps successful! Game stats and leaderboard updated."),s.status(200).json({...I,score:z,stats:e})}catch(e){return console.error("[/api/guess] \uD83D\uDCA5 Final catch: Failed in completion logic:",{error:e,message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,playerId:a,wordId:E.word_id,scoreResult:z,step:"unknown"}),s.status(200).json({...I,score:z,stats:void 0})}}s.status(200).json(I)}catch(e){console.error("[/api/guess] Error:",e),s.status(500).json({error:"Failed to submit guess"})}});t()}catch(e){t(e)}})},8355:(e,s,r)=>{r.d(s,{DD:()=>t,E6:()=>o,b6:()=>n});let t=["definition","equivalents","first_letter","in_a_sentence","number_of_letters","etymology"];function o(){return{definition:!1,equivalents:!1,first_letter:!1,in_a_sentence:!1,number_of_letters:!1,etymology:!1}}function n(e){if(e.length>t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}if(6!==t.length)throw Error("CLUE_SEQUENCE must contain exactly 6 clues");if(new Set(t).size!==t.length)throw Error("CLUE_SEQUENCE contains duplicate clues");for(let[e,s]of Object.entries({D:"definition",E:"equivalents",F:"first_letter",I:"in_a_sentence",N:"number_of_letters",E2:"etymology"}))if(!t.includes(s))throw Error(`Invalid clue key mapping: ${e} -> ${s}`)},3562:(e,s,r)=>{r.d(s,{m:()=>o});let t={GUESS_BASE_SCORES:[1e3,900,800,700,600,500],FUZZY_BONUS:25,TIME_PENALTY_PER_10_SECONDS:1,HINT_PENALTY:200};function o(e){let{guessesUsed:s,fuzzyMatches:r=0,completionTimeSeconds:o,usedHint:n=!1,isWon:a}=e;if(!a)return{score:0,baseScore:0,fuzzyBonus:0,timePenalty:0,hintPenalty:0,guessPenalty:0};let i=Math.min(s-1,t.GUESS_BASE_SCORES.length-1),l=t.GUESS_BASE_SCORES[i],d=r*t.FUZZY_BONUS,c=Math.floor(o/10)*t.TIME_PENALTY_PER_10_SECONDS,u=n?t.HINT_PENALTY:0;return{score:Math.max(0,l+d-c-u),baseScore:l,fuzzyBonus:d,timePenalty:c,hintPenalty:u,guessPenalty:0}}},9085:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.d(s,{O:()=>i});var o=r(9926),n=e([o]);let a=(o=(n.then?(await n)():n)[0]).z.object({SUPABASE_URL:o.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:o.z.string(),SUPABASE_ANON_KEY:o.z.string(),DB_PROVIDER:o.z.literal("supabase"),NODE_ENV:o.z.enum(["development","production"]).default("production"),PORT:o.z.string().transform(Number).default("3001"),FRONTEND_URL:o.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:"https://eaclljwvsicezmkjnlbm.supabase.co",SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjk3NzIsImV4cCI6MjA1OTYwNTc3Mn0.56sdQFmC4sNAbyenWoDeiA",DB_PROVIDER:"supabase",NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!a.success)throw console.error("❌ Invalid environment variables:\n",Object.entries(a.error.flatten().fieldErrors).map(([e,s])=>`${e}: ${s?.join(", ")}`).join("\n")),Error("Invalid environment variables");let i=a.data;t()}catch(e){t(e)}})},4950:(e,s,r)=>{r.d(s,{E:()=>l});var t=r(8355),o=r(301),n=r(5302);let a=async(e,s,r,a,l)=>{if(!(0,t.b6)(r))throw Error("Invalid clue sequence");if(!Date.parse(a))throw Error("Invalid start_time format");let d=(0,o.bG)(e),c=(0,o.bG)(s),u=(0,o.oe)(e,s);if(!u&&l){for(let e of r)if(function(e,s,r){let t=i(s,r);return!!t&&("equivalents"===s?(Array.isArray(r.equivalents)?r.equivalents:"string"==typeof t?t.split(",").map(e=>e.trim()):[]).some(s=>(0,o.oe)(e,s)):(0,o.oe)(e,t.toString()))}(d,e,l)){u=!0,console.log("[GuessValidation] Guess matches revealed clue:",{guess:d,clueKey:e,clueValue:i(e,l)});break}}let g=u?{isFuzzy:!1,method:"character_overlap",confidence:100,explanation:"Exact match"}:await (0,n.advancedFuzzyMatch)(d,c),m=g.isFuzzy,f=m?function(e,s){let r=[],t=Array(s.length).fill(!1);for(let o=0;o<e.length;o++)o<s.length&&e[o]===s[o]&&(r.push(o),t[o]=!0);for(let o=0;o<e.length;o++)if(!(o<s.length)||e[o]!==s[o]){for(let n=0;n<s.length;n++)if(!t[n]&&e[o]===s[n]){r.push(o),t[n]=!0;break}}return r}(d,c):[];console.log("[GuessValidation] Analysis:",{guess:d,target:c,isCorrect:u,isFuzzy:m,method:g.method,confidence:g.confidence,explanation:g.explanation,...void 0!==g.distance&&{distance:g.distance},...void 0!==g.similarity&&{similarity:g.similarity},positions:f});let p=[...r];if(!u){let e=function(e){for(let s of t.DD)if(!e.includes(s))return s;return null}(r);e&&p.push(e)}let h=u||p.length===t.DD.length;return{isCorrect:u,guess:d,isFuzzy:m,fuzzyPositions:f,gameOver:h,revealedClues:p,score:null}};function i(e,s){switch(e){case"definition":return s.definition;case"equivalents":return s.equivalents;case"first_letter":return s.first_letter;case"in_a_sentence":return s.in_a_sentence;case"number_of_letters":return s.number_of_letters;case"etymology":return s.etymology;default:return null}}let l=async(e,s,r,t)=>{if("object"==typeof e){let{guess:o,start_time:n}=e;if(!s||!r||!n)throw Error("Missing required parameters for submitGuess");return a(o,s,r,n,t)}if(!s||!r)throw Error("Missing required parameters for submitGuess");throw Error("Legacy parameter format is no longer supported")}},5302:(e,s,r)=>{r.d(s,{advancedFuzzyMatch:()=>d});var t=r(301);let o={enableSemanticMatching:!0,editDistanceThreshold:2,phoneticThreshold:.8,semanticThreshold:.75,keyboardThreshold:3,minimumWordLength:3},n={q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","y","f","g","h"],y:["t","u","g","h","j"],u:["y","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l"],p:["o","l"],a:["q","w","s","z"],s:["q","w","e","a","d","z","x"],d:["w","e","r","s","f","x","c"],f:["e","r","t","d","g","c","v"],g:["r","t","y","f","h","v","b"],h:["t","y","u","g","j","b","n"],j:["y","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k"],z:["a","s","x"],x:["s","d","z","c"],c:["d","f","x","v"],v:["f","g","c","b"],b:["g","h","v","n"],n:["h","j","b","m"],m:["j","k","n"]};function a(e){let s=e.toUpperCase().replace(/[^A-Z]/g,"");if(0===s.length)return"";let r=s[0],t=s.replace(/[BFPV]/g,"1").replace(/[CGJKQSXZ]/g,"2").replace(/[DT]/g,"3").replace(/[L]/g,"4").replace(/[MN]/g,"5").replace(/[R]/g,"6").replace(/[AEIOUHWY]/g,"0");return r+(t=t.replace(/(.)\1+/g,"$1").replace(/0/g,"")).substring(1,4).padEnd(3,"0")}function i(e){let s=e.toLowerCase();for(let e of["ing","ed","er","est","ly","tion","ness","ment","ful","less"])if(s.endsWith(e)&&s.length>e.length+2){s=s.substring(0,s.length-e.length);break}return s}async function l(e,s){try{let{computeSemanticSimilarity:t}=await r.e(367).then(r.bind(r,9367));return await t(e,s)}catch(e){return console.warn("[AdvancedFuzzyMatcher] Semantic similarity not available:",e),0}}async function d(e,s,r=o){let d=(0,t.bG)(e),c=(0,t.bG)(s);if(d.length<(r.minimumWordLength||3)||c.length<(r.minimumWordLength||3))return{isFuzzy:!1,confidence:0,method:"character_overlap",explanation:"Words too short for fuzzy matching"};if(Math.abs(d.length-c.length)>.5*Math.max(d.length,c.length))return{isFuzzy:!1,confidence:0,method:"character_overlap",explanation:"Words too different in length"};let u=function(e,s){let r=Array(s.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let s=0;s<=e.length;s++)r[0][s]=s;for(let e=0;e<=s.length;e++)r[e][0]=e;for(let t=1;t<=s.length;t++)for(let o=1;o<=e.length;o++)e[o-1]===s[t-1]?r[t][o]=r[t-1][o-1]:r[t][o]=Math.min(r[t-1][o]+1,r[t][o-1]+1,r[t-1][o-1]+1);return r[s.length][e.length]}(d,c);if(u<=(r.editDistanceThreshold||2))return{isFuzzy:!0,confidence:Math.round((1-u/Math.max(d.length,c.length))*100),method:"edit_distance",distance:u,explanation:`${u} character change${1!==u?"s":""} needed`};let g=function(e,s){if(Math.abs(e.length-s.length)>2)return 999;let r=e.length,t=s.length,o=Array(t+1).fill(null).map(()=>Array(r+1).fill(null));for(let e=0;e<=r;e++)o[0][e]=e;for(let e=0;e<=t;e++)o[e][0]=e;for(let a=1;a<=t;a++)for(let t=1;t<=r;t++)if(e[t-1]===s[a-1])o[a][t]=o[a-1][t-1];else{let r=2>=function(e,s){if(e===s)return 0;let r=n[e.toLowerCase()];if(!r)return 5;if(r.includes(s.toLowerCase()))return 1;for(let e of r){let r=n[e];if(r&&r.includes(s.toLowerCase()))return 2}return 5}(e[t-1],s[a-1])?.5:1;o[a][t]=Math.min(o[a-1][t]+1,o[a][t-1]+1,o[a-1][t-1]+r)}return o[t][r]}(d,c);if(g<=(r.keyboardThreshold||3))return{isFuzzy:!0,confidence:Math.round((1-g/5)*100),method:"keyboard",distance:g,explanation:`Keyboard layout typo detected (distance: ${g})`};let m=a(d);if(m===a(c)&&m.length>1)return{isFuzzy:!0,confidence:85,method:"phonetic",explanation:`Sounds similar (${m})`};let f=i(d);if(f===i(c)&&f.length>2)return{isFuzzy:!0,confidence:80,method:"morphological",explanation:`Same word stem: "${f}"`};if(r.enableSemanticMatching)try{let e=await l(d,c);if(e>=(r.semanticThreshold||.75))return{isFuzzy:!0,confidence:Math.round(100*e),method:"semantic",similarity:e,explanation:`Semantically related (${Math.round(100*e)}% similarity)`}}catch(e){console.warn("[AdvancedFuzzyMatcher] Semantic matching failed:",e)}let p=function(e,s){let r=[],t=0,o=0,n=Array(s.length).fill(!1);for(let o=0;o<e.length;o++)o<s.length&&e[o]===s[o]&&(r.push(o),t++,n[o]=!0);for(let t=0;t<e.length;t++)if(!(t<s.length)||e[t]!==s[t]){for(let a=0;a<s.length;a++)if(!n[a]&&e[t]===s[a]){r.push(t),o++,n[a]=!0;break}}let a=Math.max(e.length,s.length),i=Math.min(e.length,s.length),l=t+o,d=l/a,c=l>=2&&d>=.4&&(t>=1||l>=3)&&i/a>=.5;return{isFuzzy:c,confidence:c?Math.round(100*d):0}}(d,c);return p.isFuzzy?{isFuzzy:!0,confidence:p.confidence,method:"character_overlap",explanation:`Character overlap (${p.confidence}% similarity)`}:{isFuzzy:!1,confidence:0,method:"character_overlap",explanation:"No similarity detected"}}},9462:(e,s,r)=>{r.a(e,async(e,t)=>{try{r.d(s,{Y0:()=>i});var o=r(2885),n=r(9085),a=e([n]);n=(a.then?(await a)():a)[0];let l=(0,o.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_SERVICE_ROLE_KEY);async function i(e){try{let{data:s,error:r}=await l.rpc("ensure_player_exists",{p_id:e});if(r)throw console.error("[ensurePlayerExists] Failed to ensure player:",r),r;return s}catch(e){throw console.error("[ensurePlayerExists] Unexpected error:",e),e}}t()}catch(e){t(e)}})},301:(e,s,r)=>{r.d(s,{bG:()=>t,oe:()=>o});let t=e=>e?e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[\u200B\u200D\u200C\uFEFF-]/g,""):"",o=(e,s)=>t(e)===t(s)},7153:(e,s)=>{var r;Object.defineProperty(s,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,s,r)=>{e.exports=r(145)}};var s=require("../../webpack-api-runtime.js");s.C(e);var r=s(s.s=141);module.exports=r})();