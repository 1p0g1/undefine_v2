"use strict";(()=>{var e={};e.id=310,e.ids=[310],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9926:e=>{e.exports=import("zod")},6249:(e,s)=>{Object.defineProperty(s,"l",{enumerable:!0,get:function(){return function e(s,t){return t in s?s[t]:"then"in s&&"function"==typeof s.then?s.then(s=>e(s,t)):"function"==typeof s&&"default"===t?s:void 0}}})},141:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{config:()=>c,default:()=>d,routeModule:()=>u});var o=t(1802),n=t(7153),a=t(6249),i=t(5274),l=e([i]);i=(l.then?(await l)():l)[0];let d=(0,a.l)(i,"default"),c=(0,a.l)(i,"config"),u=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/guess",pathname:"/api/guess",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},7274:(e,s,t)=>{t.d(s,{o:()=>r});function r(e){return async(s,t)=>{if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Player-ID, Authorization"),"OPTIONS"===s.method){t.status(204).end();return}return e(s,t)}}},5274:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{default:()=>y});var o=t(2885),n=t(9085);t(8355);var a=t(7274),i=t(4950),l=t(301),d=t(3562),c=t(9462),u=e([n,c]);if([n,c]=u.then?(await u)():u,!n.O.SUPABASE_URL)throw console.error("❌ Missing SUPABASE_URL in env"),Error("Missing SUPABASE_URL");if(!n.O.SUPABASE_SERVICE_ROLE_KEY)throw console.error("❌ Missing SUPABASE_SERVICE_ROLE_KEY in env"),Error("Missing SUPABASE_SERVICE_ROLE_KEY");if(!n.O.DB_PROVIDER)throw console.error("❌ Missing DB_PROVIDER in env"),Error("Missing DB_PROVIDER");console.log("[/api/guess] Environment validation passed:",{hasSupabaseUrl:!!n.O.SUPABASE_URL,hasServiceRoleKey:!!n.O.SUPABASE_SERVICE_ROLE_KEY,dbProvider:n.O.DB_PROVIDER,nodeEnv:n.O.NODE_ENV});let f=(0,o.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_SERVICE_ROLE_KEY);async function g(e,s,t,r,o,n){if(!r)throw Error("Completion time is required for creating score entry");console.log("[createScoreEntry] Using NEW scoring system:",{playerId:e,wordId:s,guessesUsed:t,completionTimeSeconds:r,isWon:o,scoreBreakdown:{baseScore:n.baseScore,fuzzyBonus:n.fuzzyBonus,timePenalty:n.timePenalty,hintPenalty:n.hintPenalty,finalScore:n.score}});let{error:a}=await f.from("scores").insert([{player_id:e,word_id:s,guesses_used:t,completion_time_seconds:r,correct:o,score:n.score,base_score:n.baseScore,guess_penalty:n.guessPenalty,fuzzy_bonus:n.fuzzyBonus,time_penalty:n.timePenalty,hint_penalty:n.hintPenalty,submitted_at:new Date().toISOString()}]);if(a)throw console.error("[createScoreEntry] Failed to create score:",a),a;console.log("[createScoreEntry] Successfully stored score with NEW system")}async function p(e,s,t,r,o){if(!r)throw Error("Completion time is required for updating leaderboard");console.log("[updateLeaderboardSummary] Starting leaderboard update:",{playerId:e,wordId:s,guessesUsed:t,completionTimeSeconds:r,score:o.score});try{await (0,c.Y0)(e),console.log("[/api/guess] ✅ Step 1 completed: Player existence confirmed"),console.log("[/api/guess] Leaderboard will be updated by database trigger")}catch(t){throw console.error("[/api/guess] Error in leaderboard update:",{error:t,message:t instanceof Error?t.message:"Unknown error",playerId:e,wordId:s,scoreResult:o}),t}}async function m(e,s){let r=(0,l.bG)(s),o=0,{smartLocalFuzzyMatch:n}=await Promise.resolve().then(t.bind(t,3807));for(let s of e){let e=(0,l.bG)(s);if(e!==r)try{let s=n(e,r);s.isFuzzy&&(o++,console.log("[countFuzzyMatches] Smart local fuzzy match found:",{guess:e,target:r,method:s.method,confidence:s.confidence,explanation:s.explanation}))}catch(s){console.warn("[countFuzzyMatches] Error checking fuzzy match:",s),function(e,s){let t=0,r=s.split("");for(let s of e){let e=r.indexOf(s);-1!==e&&(t++,r.splice(e,1))}return t/Math.max(e.length,s.length)>=.4&&t>=2}(e,r)&&(o++,console.log("[countFuzzyMatches] Legacy fuzzy match found:",{guess:e,target:r,method:"legacy_character_overlap"}))}}return o}let y=(0,a.o)(async function(e,s){if("POST"!==e.method)return s.status(405).json({error:"Method not allowed"});try{let{guess:t,gameId:r,wordId:o,start_time:n}=e.body,a=e.headers["player-id"]??"anonymous";if(console.log("[/api/guess] Processing guess:",{guess:t,gameId:r,playerId:a,wordId:o}),!r||!o||!n||!t||!a){let e={gameId:r,wordId:o,playerId:a,guess:t,start_time:n},i=Object.entries(e).filter(([e,s])=>!s).map(([e,s])=>e);return console.error("[/api/guess] Missing required fields:",i),s.status(400).json({error:"Missing required fields",details:{missing:i,received:e,required:["gameId","wordId","playerId","guess","start_time"]}})}if("string"!=typeof t||0===t.trim().length)return s.status(400).json({error:"Invalid guess format",details:{guess:t,expected:"non-empty string"}});if("string"!=typeof r||"string"!=typeof o)return s.status(400).json({error:"Invalid ID format",details:{gameId:r,wordId:o,expected:"string UUIDs"}});if("string"!=typeof n||!Date.parse(n))return s.status(400).json({error:"Invalid start_time format",details:{start_time:n,expected:"ISO date string"}});console.log("[/api/guess] Looking for game session:",{gameId:r,wordId:o,playerId:a});let{data:l,error:u}=await f.from("game_sessions").select("id, player_id, word_id, start_time, created_at").eq("player_id",a).order("created_at",{ascending:!1}).limit(5);console.log("[/api/guess] Recent sessions for player:",{playerId:a,sessionCount:l?.length||0,sessions:l,allError:u?.message});let{data:y,error:h}=await f.from("game_sessions").select("*").eq("id",r).single();console.log("[/api/guess] Session lookup by gameId only:",{found:!!y,sessionPlayerId:y?.player_id,requestPlayerId:a,playerMatch:y?.player_id===a,anyError:h?.message});let{data:_,error:w}=await f.from("game_sessions").select("*").eq("id",r).eq("player_id",a).single();if(console.log("[/api/guess] Session lookup with player validation:",{hasBasicSession:!!_,basicSessionId:_?.id,basicSessionWordId:_?.word_id,basicSessionPlayerId:_?.player_id,basicError:w?.message}),w){if(console.error("[/api/guess] Session lookup failed:",{error:w,code:w.code,details:w.details,hint:w.hint,gameId:r,wordId:o,playerId:a,sessionExistsButWrongPlayer:!!y&&y.player_id!==a}),y&&y.player_id!==a)return s.status(403).json({error:"Session belongs to different player",details:{gameId:r,sessionPlayerId:y.player_id,requestPlayerId:a}});return s.status(404).json({error:"Game session not found",details:{gameId:r,playerId:a,error:w.message,code:w.code,allSessions:l?.length||0}})}if(!_)return s.status(404).json({error:"Game session not found",details:{gameId:r,playerId:a,allSessions:l?.length||0,sessionExistsButWrongPlayer:!!y}});if(_.word_id!==o)return console.error("[/api/guess] Word ID mismatch:",{sessionWordId:_.word_id,requestWordId:o}),s.status(404).json({error:"Word ID mismatch",details:{sessionWordId:_.word_id,requestWordId:o}});let{data:E,error:S}=await f.from("game_sessions").select(`
        id,
        word_id,
        revealed_clues,
        guesses,
        is_complete,
        start_time,
        clue_status,
        words (
          word,
          definition,
          etymology,
          first_letter,
          in_a_sentence,
          number_of_letters,
          equivalents,
          difficulty,
          date
        )
      `).eq("id",r).single();if(console.log("[/api/guess] Full session with join result:",{hasGameSession:!!E,sessionError:S?.message,sessionErrorCode:S?.code,sessionErrorDetails:S?.details,gameSessionWordId:E?.word_id}),S||!E){if(console.error("[/api/guess] Failed to fetch game session with join:",{error:S,details:S?.details,hint:S?.hint,code:S?.code,gameId:r,wordId:o,playerId:a,basicSessionExists:!!_,basicSessionWordId:_?.word_id}),_){console.log("[/api/guess] Basic session exists, trying without words join...");let{data:e,error:o}=await f.from("words").select("word, definition, etymology, first_letter, in_a_sentence, number_of_letters, equivalents, difficulty, date").eq("id",_.word_id).single();if(console.log("[/api/guess] Word lookup result:",{hasWord:!!e,wordError:o?.message,wordId:_.word_id}),o||!e)return s.status(500).json({error:"Failed to fetch word data",details:{wordId:_.word_id,wordError:o?.message}});let l={..._,words:e};if(console.log("[/api/guess] Using combined session data"),l.is_complete)return s.status(400).json({error:"Game session is already complete"});if(l.start_time!==n)return console.error("[/api/guess] Start time mismatch:",{session:l.start_time,request:n}),s.status(400).json({error:"Invalid start time",details:"Start time does not match game session"});let u=await (0,i.E)({guess:t,gameId:r,playerId:a,wordId:l.word_id,start_time:l.start_time},l.words.word,l.revealed_clues||[]),y=u.gameOver?Math.floor((Date.now()-new Date(l.start_time).getTime())/1e3):null,h=[...l.guesses||[],u.guess],w=await m(l.guesses||[],l.words.word),E=u.gameOver?(0,d.m)({guessesUsed:h.length,fuzzyMatches:w+(u.isFuzzy?1:0),completionTimeSeconds:y||0,isWon:u.isCorrect}):null,S={guesses:[...l.guesses||[],u.guess],revealed_clues:u.revealedClues,clue_status:u.revealedClues.reduce((e,s)=>({...e,[s]:!0}),l.clue_status||{}),is_complete:u.gameOver,is_won:u.isCorrect,end_time:u.gameOver?new Date().toISOString():null,updated_at:new Date().toISOString()};console.log("[/api/guess] Updating session with data:",{gameId:r,updateData:S,originalGuesses:l.guesses,newGuess:u.guess});let{error:P}=await f.from("game_sessions").update(S).eq("id",r);if(P)return console.error("[/api/guess] Failed to update game session:",{error:P,message:P.message,code:P.code,details:P.details,hint:P.hint,gameId:r,updateData:S}),s.status(500).json({error:"Failed to update game session",details:{message:P.message,code:P.code}});if(u.gameOver&&y&&E){let e;console.log("[/api/guess] Game completed, updating stats and scores:",{playerId:a,isCorrect:u.isCorrect,guessesUsed:l.guesses.length+1,completionTimeSeconds:y,scoreResult:{score:E.score,baseScore:E.baseScore,fuzzyBonus:E.fuzzyBonus,timePenalty:E.timePenalty,hintPenalty:E.hintPenalty}});try{if(!a)return console.error("[/api/guess] Missing player ID"),s.status(200).json({...u,score:E,stats:void 0});console.log("[/api/guess] Step 1: Ensuring player exists for player ID:",a);try{await (0,c.Y0)(a),console.log("[/api/guess] ✅ Step 1 completed: Player existence confirmed")}catch(e){return console.error("[/api/guess] ❌ Step 1 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a}),s.status(200).json({...u,score:E,stats:void 0})}if(!l?.word_id)return console.error("[/api/guess] Missing word_id in session"),s.status(200).json({...u,score:E,stats:void 0});if("number"!=typeof y||y<0)return console.error("[/api/guess] Invalid completion time:",y),s.status(200).json({...u,score:E,stats:void 0});console.log("[/api/guess] Step 2: Ensuring player FK record");try{await (0,c.Y0)(a),e=void 0,console.log("[/api/guess] ✅ Step 2 completed: Player FK record ensured")}catch(e){throw console.error("[/api/guess] ❌ Step 2 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:l.word_id}),e}console.log("[/api/guess] Step 3: Creating score entry");try{await g(a,l.word_id,l.guesses.length+1,y,u.isCorrect,E),console.log("[/api/guess] ✅ Step 3 completed: Score entry created successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 3 failed: createScoreEntry error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:l.word_id,scoreResult:E}),e}console.log("[/api/guess] Step 4: Updating leaderboard summary");try{await p(a,l.word_id,l.guesses.length+1,y,E),console.log("[/api/guess] ✅ Step 4 completed: Leaderboard updated successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 4 failed: updateLeaderboardSummary error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:l.word_id,scoreResult:E}),e}console.log("[/api/guess] Step 5: Fetching updated player stats");try{let{data:s,error:t}=await f.from("player_streaks").select("current_streak, highest_streak, last_win_date").eq("player_id",a).single();t?console.error("[/api/guess] ❌ Step 5 failed: Stats query error:",t):(console.log("[/api/guess] ✅ Step 5 completed: Player stats fetched:",s),e={games_played:0,games_won:0,current_streak:s?.current_streak||0,longest_streak:s?.highest_streak||0,total_guesses:0,average_guesses_per_game:0,total_play_time_seconds:0,total_score:0,updated_at:new Date().toISOString()})}catch(e){console.error("[/api/guess] ❌ Step 5 failed: Exception fetching stats:",e)}return console.log("[/api/guess] \uD83C\uDF89 All completion steps successful! Game stats and leaderboard updated."),s.status(200).json({...u,score:E,stats:e})}catch(e){return console.error("[/api/guess] \uD83D\uDCA5 Final catch: Failed in completion logic:",{error:e,message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,playerId:a,wordId:l.word_id,scoreResult:E,step:"unknown"}),s.status(200).json({...u,score:E,stats:void 0})}}return s.status(200).json(u)}return s.status(404).json({error:"Game session not found",details:"Invalid game session or word ID"})}if(E.is_complete)return s.status(400).json({error:"Game session is already complete"});if(E.start_time!==n)return console.error("[/api/guess] Start time mismatch:",{session:E.start_time,request:n}),s.status(400).json({error:"Invalid start time",details:"Start time does not match game session"});let P=await (0,i.E)({guess:t,gameId:r,playerId:a,wordId:E.word_id,start_time:E.start_time},E.words.word,E.revealed_clues||[]),b=P.gameOver?Math.floor((Date.now()-new Date(E.start_time).getTime())/1e3):null,z=[...E.guesses||[],P.guess],v=await m(E.guesses||[],E.words.word),I=P.gameOver?(0,d.m)({guessesUsed:z.length,fuzzyMatches:v+(P.isFuzzy?1:0),completionTimeSeconds:b||0,isWon:P.isCorrect}):null,O={guesses:[...E.guesses||[],P.guess],revealed_clues:P.revealedClues,clue_status:P.revealedClues.reduce((e,s)=>({...e,[s]:!0}),E.clue_status||{}),is_complete:P.gameOver,is_won:P.isCorrect,end_time:P.gameOver?new Date().toISOString():null,updated_at:new Date().toISOString()};console.log("[/api/guess] Updating session with data:",{gameId:r,updateData:O,originalGuesses:E.guesses,newGuess:P.guess});let{error:A}=await f.from("game_sessions").update(O).eq("id",r);if(A)return console.error("[/api/guess] Failed to update game session:",{error:A,message:A.message,code:A.code,details:A.details,hint:A.hint,gameId:r,updateData:O}),s.status(500).json({error:"Failed to update game session",details:{message:A.message,code:A.code}});if(P.gameOver&&b&&I){let e;console.log("[/api/guess] Game completed, updating stats and scores:",{playerId:a,isCorrect:P.isCorrect,guessesUsed:E.guesses.length+1,completionTimeSeconds:b,scoreResult:{score:I.score,baseScore:I.baseScore,fuzzyBonus:I.fuzzyBonus,timePenalty:I.timePenalty,hintPenalty:I.hintPenalty}});try{if(!a)return console.error("[/api/guess] Missing player ID"),s.status(200).json({...P,score:I,stats:void 0});console.log("[/api/guess] Step 1: Ensuring player exists for player ID:",a);try{await (0,c.Y0)(a),console.log("[/api/guess] ✅ Step 1 completed: Player existence confirmed")}catch(e){return console.error("[/api/guess] ❌ Step 1 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a}),s.status(200).json({...P,score:I,stats:void 0})}if(!E?.word_id)return console.error("[/api/guess] Missing word_id in session"),s.status(200).json({...P,score:I,stats:void 0});if("number"!=typeof b||b<0)return console.error("[/api/guess] Invalid completion time:",b),s.status(200).json({...P,score:I,stats:void 0});console.log("[/api/guess] Step 2: Ensuring player FK record");try{await (0,c.Y0)(a),e=void 0,console.log("[/api/guess] ✅ Step 2 completed: Player FK record ensured")}catch(e){throw console.error("[/api/guess] ❌ Step 2 failed: ensurePlayerExists error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:E.word_id}),e}console.log("[/api/guess] Step 3: Creating score entry");try{await g(a,E.word_id,E.guesses.length+1,b,P.isCorrect,I),console.log("[/api/guess] ✅ Step 3 completed: Score entry created successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 3 failed: createScoreEntry error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:E.word_id,scoreResult:I}),e}console.log("[/api/guess] Step 4: Updating leaderboard summary");try{await p(a,E.word_id,E.guesses.length+1,b,I),console.log("[/api/guess] ✅ Step 4 completed: Leaderboard updated successfully")}catch(e){throw console.error("[/api/guess] ❌ Step 4 failed: updateLeaderboardSummary error:",{error:e,message:e instanceof Error?e.message:"Unknown error",code:e?.code,details:e?.details,playerId:a,wordId:E.word_id,scoreResult:I}),e}console.log("[/api/guess] Step 5: Fetching updated player stats");try{let{data:s,error:t}=await f.from("player_streaks").select("current_streak, highest_streak, last_win_date").eq("player_id",a).single();t?console.error("[/api/guess] ❌ Step 5 failed: Stats query error:",t):(console.log("[/api/guess] ✅ Step 5 completed: Player stats fetched:",s),e={games_played:0,games_won:0,current_streak:s?.current_streak||0,longest_streak:s?.highest_streak||0,total_guesses:0,average_guesses_per_game:0,total_play_time_seconds:0,total_score:0,updated_at:new Date().toISOString()})}catch(e){console.error("[/api/guess] ❌ Step 5 failed: Exception fetching stats:",e)}return console.log("[/api/guess] \uD83C\uDF89 All completion steps successful! Game stats and leaderboard updated."),s.status(200).json({...P,score:I,stats:e})}catch(e){return console.error("[/api/guess] \uD83D\uDCA5 Final catch: Failed in completion logic:",{error:e,message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,playerId:a,wordId:E.word_id,scoreResult:I,step:"unknown"}),s.status(200).json({...P,score:I,stats:void 0})}}s.status(200).json(P)}catch(e){console.error("[/api/guess] Error:",e),s.status(500).json({error:"Failed to submit guess"})}});r()}catch(e){r(e)}})},8355:(e,s,t)=>{t.d(s,{DD:()=>r,E6:()=>o,b6:()=>n});let r=["definition","equivalents","first_letter","in_a_sentence","number_of_letters","etymology"];function o(){return{definition:!1,equivalents:!1,first_letter:!1,in_a_sentence:!1,number_of_letters:!1,etymology:!1}}function n(e){if(e.length>r.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==r[s])return!1;return!0}if(6!==r.length)throw Error("CLUE_SEQUENCE must contain exactly 6 clues");if(new Set(r).size!==r.length)throw Error("CLUE_SEQUENCE contains duplicate clues");for(let[e,s]of Object.entries({D:"definition",E:"equivalents",F:"first_letter",I:"in_a_sentence",N:"number_of_letters",E2:"etymology"}))if(!r.includes(s))throw Error(`Invalid clue key mapping: ${e} -> ${s}`)},3562:(e,s,t)=>{t.d(s,{m:()=>o});let r={PERFECT_SCORE:1e3,GUESS_PENALTY:100,FUZZY_BONUS:50,TIME_PENALTY_PER_10_SECONDS:1};function o(e){let{guessesUsed:s,fuzzyMatches:t=0,completionTimeSeconds:o,isWon:n}=e;if(!n)return{score:0,baseScore:0,fuzzyBonus:0,timePenalty:0,guessPenalty:0,hintPenalty:0};let a=r.PERFECT_SCORE-(s-1)*r.GUESS_PENALTY,i=t*r.FUZZY_BONUS,l=Math.floor(o/10)*r.TIME_PENALTY_PER_10_SECONDS;return{score:Math.max(0,a+i-l),baseScore:a,fuzzyBonus:i,timePenalty:l,guessPenalty:0,hintPenalty:0}}},9085:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{O:()=>i});var o=t(9926),n=e([o]);let a=(o=(n.then?(await n)():n)[0]).z.object({SUPABASE_URL:o.z.string().url(),SUPABASE_SERVICE_ROLE_KEY:o.z.string(),SUPABASE_ANON_KEY:o.z.string(),DB_PROVIDER:o.z.literal("supabase"),NODE_ENV:o.z.enum(["development","production"]).default("production"),PORT:o.z.string().transform(Number).default("3001"),FRONTEND_URL:o.z.string().url().default("http://localhost:5173")}).safeParse({SUPABASE_URL:process.env.SUPABASE_URL,SUPABASE_SERVICE_ROLE_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhY2xsand2c2ljZXpta2pubGJtIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NDAyOTc3MiwiZXhwIjoyMDU5NjA1NzcyfQ.qAwl1_vgAK8qMv44dOWPoZ6u_w5PqwGEdRmOgXeKJbY",SUPABASE_ANON_KEY:process.env.SUPABASE_ANON_KEY,DB_PROVIDER:"supabase",NODE_ENV:"production",PORT:process.env.PORT,FRONTEND_URL:process.env.FRONTEND_URL});if(!a.success)throw console.error("❌ Invalid environment variables:\n",Object.entries(a.error.flatten().fieldErrors).map(([e,s])=>`${e}: ${s?.join(", ")}`).join("\n")),Error("Invalid environment variables");let i=a.data;r()}catch(e){r(e)}})},4950:(e,s,t)=>{t.d(s,{E:()=>i});var r=t(8355),o=t(301),n=t(3807);let a=async(e,s,t,a)=>{if(!(0,r.b6)(t))throw Error("Invalid clue sequence");if(!Date.parse(a))throw Error("Invalid start_time format");let i=(0,o.bG)(e),l=(0,o.bG)(s),d=(0,o.oe)(e,s),c=(0,n.smartLocalFuzzyMatch)(i,l),u=c.isFuzzy,g=u?function(e,s){let t=[],r=Array(s.length).fill(!1);for(let o=0;o<e.length;o++)o<s.length&&e[o]===s[o]&&(t.push(o),r[o]=!0);for(let o=0;o<e.length;o++)if(!(o<s.length)||e[o]!==s[o]){for(let n=0;n<s.length;n++)if(!r[n]&&e[o]===s[n]){t.push(o),r[n]=!0;break}}return t}(i,l):[];console.log("[FuzzyMatch] Smart Local Analysis:",{guess:i,target:l,isFuzzy:u,method:c.method,confidence:c.confidence,explanation:c.explanation,positions:g});let p=[...t];if(!d){let e=function(e){for(let s of r.DD)if(!e.includes(s))return s;return null}(t);e&&p.push(e)}let m=d||p.length===r.DD.length;return{isCorrect:d,guess:i,isFuzzy:u,fuzzyPositions:g,gameOver:m,revealedClues:p,score:null}},i=async(e,s,t)=>{if("object"==typeof e){let{guess:r,start_time:o}=e;if(!s||!t||!o)throw Error("Missing required parameters for submitGuess");return a(r,s,t,o)}if(!s||!t)throw Error("Missing required parameters for submitGuess");throw Error("Legacy parameter format is no longer supported")}},9462:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{Y0:()=>i});var o=t(2885),n=t(9085),a=e([n]);n=(a.then?(await a)():a)[0];let l=(0,o.createClient)(n.O.SUPABASE_URL,n.O.SUPABASE_SERVICE_ROLE_KEY);async function i(e){try{let{data:s,error:t}=await l.rpc("ensure_player_exists",{p_id:e});if(t)throw console.error("[ensurePlayerExists] Failed to ensure player:",t),t;return s}catch(e){throw console.error("[ensurePlayerExists] Unexpected error:",e),e}}r()}catch(e){r(e)}})},3807:(e,s,t)=>{t.d(s,{smartLocalFuzzyMatch:()=>n});let r={receive:["recieve"],believe:["beleive"],achieve:["acheive"],accommodate:["accomodate","acommodate"],necessary:["neccessary","necesary"],occurred:["occured","ocurred"],beginning:["begining","beggining"],separate:["seperate"],definitely:["definately","definetly"],maintenance:["maintainence"],government:["goverment","govermnent"],different:["diffrent","diferent"],probably:["probaly","proably"],really:["realy","relly"],until:["untill"],truly:["truely"],forty:["fourty"]},o={q:"wa",w:"qeas",e:"wrds",r:"etdf",t:"ryfg",y:"tugh",u:"yihj",i:"ujok",o:"ikpl",p:"ol",a:"qwsz",s:"awedxz",d:"serfcx",f:"drtgvc",g:"ftyhjb",h:"gtyunb",j:"hyuimn",k:"juiol",l:"kiop",z:"asx",x:"zsdcv",c:"xdfvb",v:"cfgbn",b:"vghnm",n:"bhjm",m:"njk"};function n(e,s){let t=e.toLowerCase().trim(),n=s.toLowerCase().trim();if(t===n)return{isFuzzy:!1,confidence:100,method:"exact",explanation:"Exact match"};for(let[e,s]of Object.entries(r))if(n===e&&s.includes(t)||t===e&&s.includes(n))return{isFuzzy:!0,confidence:95,method:"common_misspelling",explanation:`Common misspelling of "${e}"`};let l=function(e,s){if(Math.abs(e.length-s.length)>2)return{isFuzzy:!1,confidence:0,method:"edit_distance",explanation:"Too different in length"};let t=function(e,s){if(e===s)return 0;if(0===e.length)return s.length;if(0===s.length)return e.length;let t=Array.from({length:s.length+1},(e,s)=>s);for(let r=0;r<e.length;r++){let o=[r+1];for(let n=0;n<s.length;n++){let a=e[r]===s[n]?0:1;o[n+1]=Math.min(o[n]+1,t[n+1]+1,t[n]+a)}t=o}return t[s.length]}(e,s),r=Math.max(e.length,s.length);return t<=1||t<=2&&r>=6?{isFuzzy:!0,confidence:Math.round((1-t/r)*100),method:"edit_distance",explanation:`${t} character change${1!==t?"s":""} needed`}:{isFuzzy:!1,confidence:0,method:"edit_distance",explanation:"Too many changes needed"}}(t,n);if(l.isFuzzy)return l;let d=function(e,s){if(Math.abs(e.length-s.length)>1)return{isFuzzy:!1,confidence:0,method:"keyboard_typo",explanation:"Length difference too big"};let t=0,r=0,n=Math.min(e.length,s.length);for(let a=0;a<n;a++)e[a]===s[a]?r++:(o[e[a]]||"").includes(s[a])?t++:t+=2;return(t+=Math.abs(e.length-s.length))<=2&&r>=n-2?{isFuzzy:!0,confidence:Math.round(r/Math.max(e.length,s.length)*100),method:"keyboard_typo",explanation:`Keyboard typo detected (${t} mistake${1!==t?"s":""})`}:{isFuzzy:!1,confidence:0,method:"keyboard_typo",explanation:"Not a keyboard typo"}}(t,n);if(d.isFuzzy)return d;let c=function(e,s){if(e.length!==s.length)return{isFuzzy:!1,confidence:0,method:"letter_pattern",explanation:"Length mismatch"};if(e.length<5)return{isFuzzy:!1,confidence:0,method:"letter_pattern",explanation:"Too short for pattern matching"};let t=a(e),r=a(s),o=0,n=0;for(let t=0;t<e.length;t++)e[t]===s[t]&&n++;for(let[e,s]of Object.entries(t))o+=Math.min(s,r[e]||0);let i=o/e.length,l=n/e.length;return i>=.9&&l>=.6&&o>=4?{isFuzzy:!0,confidence:Math.round(100*i),method:"letter_pattern",explanation:`Letter transposition (${n}/${e.length} correct positions)`}:{isFuzzy:!1,confidence:0,method:"letter_pattern",explanation:"Not a simple letter transposition"}}(t,n);if(c.isFuzzy)return c;let u=function(e,s){let t=i(e);return t===i(s)&&t.length>=3?{isFuzzy:!0,confidence:85,method:"phonetic_local",explanation:`Sounds similar (${t})`}:{isFuzzy:!1,confidence:0,method:"phonetic_local",explanation:"Different sounds"}}(t,n);return u.isFuzzy?u:{isFuzzy:!1,confidence:0,method:"none",explanation:"No similarity detected"}}function a(e){let s={};for(let t of e)s[t]=(s[t]||0)+1;return s}function i(e){return e.toLowerCase().replace(/[aeiou]/g,"").replace(/(.)\1+/g,"$1").replace(/ck/g,"k").replace(/ph/g,"f").replace(/th/g,"t").replace(/ch/g,"k").replace(/sh/g,"s").substring(0,4)}},301:(e,s,t)=>{t.d(s,{bG:()=>r,oe:()=>o});let r=e=>e?e.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[\u200B\u200D\u200C\uFEFF-]/g,""):"",o=(e,s)=>r(e)===r(s)},7153:(e,s)=>{var t;Object.defineProperty(s,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,s,t)=>{e.exports=t(145)}};var s=require("../../webpack-api-runtime.js");s.C(e);var t=s(s.s=141);module.exports=t})();